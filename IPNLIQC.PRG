***************************************
* LIQUIDACION CONTRUCCION              *
****************************************
   IF WMOTIVO = "TERMINACION"
       STORE 1 TO FFPP
       STORE 1 TO FFCC
       STORE 1 TO FFAA
   ELSE
      if wmotivo = "RENUNCIA"
          STORE 0 TO FFPP
          STORE 1 TO FFCC
          STORE 1 TO FFAA
       ELSE
          STORE 2 TO FFPP
          STORE 2 TO FFCC
          STORE 2 TO FFAA
       ENDIF
   ENDIF
   SELECT 4
   USE IPNOMINA
   LOCATE FOR CODNOM = WNOMINA
   IF .NOT. FOUND()
      STORE "ERROR, LA NOMINA DE ESTA PERSONA NO ESTA REGISTRADA" TO MES
      DO AVISO WITH MES
      USE
      RETURN
   ENDIF
   STORE DESNOM TO WDESCRINOM
   STORE LUGAR  TO WLUGAR

   STORE (WSUELDO+WBONOCO) TO Wbasicodia
   STORE WBASICODIA TO VARIABLE
   DO REDONDEO WITH VARIABLE
   STORE VARIABLE TO WBASICODIA
   STORE ROUND(WBASICODIA,2) TO WBASICODIA

   STORE 0 TO EXAMEN
*  STORE (WSUELDO+WBONOCO) TO EXAMEN
   STORE EXAMEN TO VARIABLE
   DO REDONDEO WITH VARIABLE
   STORE VARIABLE TO EXAMEN
   STORE ROUND(EXAMEN,2) TO EXAMEN

   STORE SPACE(35) TO QQWW
   DO INFORMA WITH QQWW
   IF QQWW <> T3
      CLOSE DATA
      CLOSE INDEX
      STORE "ERROR DE INSTALACION" TO MES
      DO AVISO WITH MES
      RETURN
   ENDIF

   store 0 to wnetovac
   SELECT 4
   USE IPNCONST
   GO TOP
   LOCATE FOR meses > xmes
   IF .NOT. FOUND()
      STORE "ERROR, "+WCEDULA+" TABLA DE LIQUIDACION SIN MESES APROPIADOS" TO MES
      DO AVISO WITH MES
      USE
      RETURN
   ENDIF
   IF RECNO()>1
      GO RECNO()-1
   ENDIF
   STORE PREAVISO   TO WTPREAVISO
   STORE ANTIGUEDAD TO WTANTIGUE
   STORE ANTIGUEDA2 TO WTANTIGUE2
   STORE VACACION   TO WTVACACION
   STORE UTILIDAD   TO WTUTILIDAD
   STORE TOTAL      TO WTTOTAL
   STORE GARANTIA   TO WTGARANTIA
   store bonovac    to wnetovac

   * ANTIGUEDAD ADICIONAL
   STORE (FECHALIQ-IPNPERSO.INGRESO)+1 TO WDIASAA
   STORE INT(WDIASAA/30.4166667)       TO WMESAA
   SELECT 4
   USE IPNCONST
   GO TOP
   LOCATE FOR meses > WMESAA
   IF .NOT. FOUND()
      STORE "ERROR, "+WCEDULA+" TABLA DE LIQUIDACION SIN MESES DE ANTIG. ADIC." TO MES
      DO AVISO WITH MES
      CLOSE DATA
      CLOSE INDEX
      RETURN TO MASTER
   ENDIF
   IF RECNO()>1
      GO RECNO()-1
   ENDIF
   STORE CESANTIA   TO WTCESANTIA

   *********** BUSQUEDA DE HISTORICO ****************
   SELECT IPNHISTO
   SORT TO IPNTEMP2 ON FECHA /D FOR;
                                    CEDULA =  WCEDULA .AND.;
                                    NOMINA <> "UTLDA" .AND.;
                                    NOMINA <> "LIQUI" .AND.;
                                    FECHA  <= FECHALIQ
   SELECT 4
   USE IPNTEMP2
   PACK
   IF WTIPO = "E"
      STORE 2 TO BUSCAR
      STORE 30 TO DIVIDIR
   ELSE
      STORE 4 TO BUSCAR
      STORE 28 TO DIVIDIR
   ENDIF

   *******   CALCULO DEL TOTAL BONIFICABLE *************
   STORE 0 TO CONTEO
   STORE 0 TO ACUMULADO
   STORE 10 TO ZX
   DO WHILE .NOT. EOF() .AND. CONTEO < BUSCAR
      STORE ACUMULADO + (BSTOTBON+BSTOTNBON-BSTOTDEC) TO ACUMULADO
      STORE CONTEO +1 TO CONTEO
      SKIP
   ENDDO
   STORE ACUMULADO/DIVIDIR TO PROMEDIODIA
   STORE PROMEDIODIA TO VARIABLE
   DO REDONDEO WITH VARIABLE
   STORE VARIABLE TO PROMEDIODIA
   STORE ROUND(PROMEDIODIA,2) TO PROMEDIODIA

   *** PREAVISO ***
   STORE WBASICODIA*WTPREAVISO TO BSPREAVISO
   STORE BSPREAVISO TO VARIABLE
   DO REDONDEO WITH VARIABLE
   STORE VARIABLE TO BSPREAVISO
   STORE BSPREAVISO*FFPP TO BSPREAVISO
   STORE ROUND(BSPREAVISO,2) TO BSPREAVISO

   *** ANTIGUEDAD LEGAL ***
   STORE PROMEDIODIA*WTANTIGUE TO BSANTIGUE
   STORE BSANTIGUE TO VARIABLE
   DO REDONDEO WITH VARIABLE
   STORE VARIABLE TO BSANTIGUE
   STORE BSANTIGUE*FFAA TO BSANTIGUE
   STORE ROUND(BSANTIGUE,2) TO BSANTIGUE

   *** ANTIGUEDAD CONTRACTUAL ***
   STORE PROMEDIODIA*WTANTIGUE2 TO BSANTIGUE2
   STORE BSANTIGUE2 TO VARIABLE
   DO REDONDEO WITH VARIABLE
   STORE VARIABLE TO BSANTIGUE2
   STORE BSANTIGUE2*FFAA TO BSANTIGUE2
   STORE ROUND(BSANTIGUE2,2) TO BSANTIGUE2

   *** CESANTIA ***
   STORE PROMEDIODIA*WTCESANTIA TO BSCESANTIA
   STORE BSCESANTIA TO VARIABLE
   DO REDONDEO WITH VARIABLE
   STORE VARIABLE TO BSCESANTIA
   STORE BSCESANTIA*FFCC TO BSCESANTIA
   STORE ROUND(BSCESANTIA,2) TO BSCESANTIA

   *** VACACIONES ***
   STORE WBASICODIA*WTVACACION TO BSVACACION
   STORE BSVACACION TO VARIABLE
   DO REDONDEO WITH VARIABLE
   STORE VARIABLE TO BSVACACION
   STORE ROUND(BSVACACION,2) TO BSVACACION

   *** BONO VACACIONAL ***
   STORE WNETOVAC*WBASICODIA TO BSBONOVAC
   STORE BSBONOVAC TO VARIABLE
   DO REDONDEO WITH VARIABLE
   STORE VARIABLE TO BSBONOVAC
   STORE ROUND(BSBONOVAC,2) TO BSBONOVAC

   *** EXAMEN ***
   STORE EXAMEN TO BSEXAMEN

   store BSPREAVISO+BSANTIGUE+BSANTIGUE2+BSCESANTIA+BSVACACION+BSBONOVAC+BSEXAMEN TO WTOTALPAGAR

      *********** CALCULO DEL MONTO ESCRITO
      STORE Wtotalpagar TO WMONTO
      STORE WTOTALPAGAR TO WNETO
      STORE INT(WMONTO/1000000) TO MILLONES
      STORE WMONTO-MILLONES*1000000 TO WMONTO
      STORE INT(WMONTO/1000) TO MILES
      STORE WMONTO-MILES*1000 TO WMONTO
      STORE INT(WMONTO/100) TO CIENTOS
      STORE WMONTO-CIENTOS*100 TO WMONTO
      STORE INT(WMONTO/10) TO DECENAS
      STORE WMONTO-DECENAS*10 TO WMONTO
      STORE INT(WMONTO/1) TO UNIDADES
      STORE WMONTO-UNIDADES*1 TO WMONTO
      STORE (WNETO-INT(WNETO))*100 TO CENTIMOS
      SELECT 9
      USE IPNMONTO
      store space(50) to escrito
      ***** MILLONES ******
      GO TOP
      LOCATE FOR VALOR > MILLONES
      IF .NOT. FOUND()
         STORE "ERROR, NO ENCONTRE LOS MILLONES APROPIADOS" TO MES
         DO AVISO WITH MES
      ENDIF
      GO RECNO()-1
      IF VALOR > 0
         STORE RTRIM(escrito)+" "+DES TO escrito
      ENDIF
      STORE MILLONES-VALOR TO RESTO
      STORE .T. TO CHECKREST
      DO WHILE CHECKREST
         GO TOP
         IF RESTO = 0
            STORE .F. TO CHECKREST
            LOOP
         ENDIF
         LOCATE FOR VALOR > RESTO
         IF .NOT. FOUND()
            STORE "ERROR, NO ENCONTRE EL RESTO DE LOS MILLONES APROPIADOS" TO MES
            DO AVISO WITH MES
         ENDIF
         GO RECNO()-1
         STORE RTRIM(escrito)+" Y "+DES TO escrito
         STORE RESTO-VALOR TO RESTO
      ENDDO
      IF MILLONES = 1
         STORE RTRIM(escrito)+" MILLON " TO escrito
      ELSE
         IF MILLONES > 1
            STORE RTRIM(escrito)+" MILLONES " TO escrito
         ENDIF
      ENDIF
      ***** MILES ******
      GO TOP
      LOCATE FOR VALOR > MILES
      IF .NOT. FOUND()
         STORE "ERROR, NO ENCONTRE LOS MILES APROPIADOS" TO MES
         DO AVISO WITH MES
      ENDIF
      GO RECNO()-1
      IF VALOR > 0
         STORE RTRIM(escrito)+" "+DES TO escrito
      ENDIF
      STORE MILES-VALOR TO RESTO
      IF MILES >= 100 .AND. MILES < 200 .AND. RESTO > 0
         STORE RTRIM(escrito)+"TO" TO escrito
      ENDIF
      STORE .T. TO CHECKREST
      DO WHILE CHECKREST
         GO TOP
         IF RESTO = 0
            STORE .F. TO CHECKREST
            LOOP
         ENDIF
         LOCATE FOR VALOR > RESTO
         IF .NOT. FOUND()
            STORE "ERROR, NO ENCONTRE EL RESTO DE LOS MILES APROPIADOS" TO MES
            DO AVISO WITH MES
         ENDIF
         GO RECNO()-1
         STORE RTRIM(escrito)+" "+DES TO escrito
         STORE RESTO-VALOR TO RESTO
      ENDDO
      IF MILES > 0
         STORE RTRIM(escrito)+" MIL " TO escrito
      ENDIF

      ***** CIENTOS ****
      GO TOP
      LOCATE FOR VALOR > CIENTOS*100
      IF .NOT. FOUND()
         STORE "ERROR, NO ENCONTRE LOS CIENTOS APROPIADOS" TO MES
         DO AVISO WITH MES
      ENDIF
      GO RECNO()-1
      IF VALOR > 0
         STORE RTRIM(escrito)+" "+DES TO escrito
      ENDIF
      IF CIENTOS = 1 .AND. DECENAS*10+UNIDADES > 0
         STORE RTRIM(escrito)+"TO" TO escrito
      ENDIF

      ***** DECENAS ****
      IF DECENAS > 1
         GO TOP
         LOCATE FOR VALOR > DECENAS*10
         IF .NOT. FOUND()
            STORE "ERROR, NO ENCONTRE LAS DECENAS APROPIADAS" TO MES
            DO AVISO WITH MES
         ENDIF
         GO RECNO()-1
         IF VALOR > 0
            STORE RTRIM(escrito)+" "+DES TO escrito
         ENDIF
      ELSE
         STORE DECENAS*10+UNIDADES TO UNIDADES
      ENDIF

      ***** UNIDADES ****
      GO TOP
      LOCATE FOR VALOR > UNIDADES
      IF .NOT. FOUND()
         STORE "ERROR, NO ENCONTRE LAS UNIDADES APROPIADAS" TO MES
         DO AVISO WITH MES
      ENDIF
      GO RECNO()-1
      IF VALOR > 0
         STORE RTRIM(escrito)+" Y "+DES TO escrito
      ENDIF
      STOR UNIDADES-VALOR TO RESTO
      STORE .T. TO CHECKREST
      DO WHILE CHECKREST
         GO TOP
         IF RESTO = 0
            STORE .F. TO CHECKREST
            LOOP
         ENDIF
         LOCATE FOR VALOR > RESTO
         IF .NOT. FOUND()
            STORE "ERROR, NO ENCONTRE EL RESTO DE LAS UNIDADES APROPIADAS" TO MES
            DO AVISO WITH MES
         ENDIF
         GO RECNO()-1
         STORE RTRIM(escrito)+" Y "+DES TO escrito
         STORE RESTO-VALOR TO RESTO
      ENDDO
      STORE RTRIM(escrito)+" Bolivares con " TO escrito

      ***** CENTIMOS ****

      STORE RTRIM(escrito)+" "+LTRIM(RTRIM(STR(CENTIMOS,5)))+" CENTIMOS" TO escrito
      *********  FIN CALCULO MONTO ESCRITO   **********

   IF WFLAGAS = .T.
      SET DEVI TO PRINT
      @ 0,28 SAY QQWW
      @ 2,13  SAY "FINIQUITO DE INDEMNIZACION POR TERMINACION DE CONTRATO"
      @ 4,33  SAY "LUGAR Y FECHA : "+CHR(15)+RTRIM(WLUGAR)+" "+DTOC(WFECACT)+CHR(18)
      @ 6,1   SAY "Yo, "+RTRIM(WNOMBRE)+" "+WAPELLIDO+" Cedula de identidad No."+WCEDULA
      @ 8,1   SAY "Hago constar que he recibido de "+QQWW+", la suma de"
      @ 10,1  say "**"+chr(15)+escrito+chr(18)+" ** (Bs. "+str(wtotalpagar,9,2)+" )"
      @ 12,1  SAY "En car cter de Indemnizaci¢n por la terminaci¢n de mi contrato de ----"
      @ 14,1  say "trabajo con ella, en la obra: "+wdescrinom
      @ 16,1  say "seg£n la siguiente relaci¢n:"
      @ 19,1  say "MOTIVO POR EL CUAL TERMINO MI CONTRATO DE TRABAJO: "+WMOTIVO
      @ 21,26 SAY "Fecha de mi Empleo  Dia:"+STR(day(wingreso),2)+"   Mes:"+STR(month(wingreso),2)+"  A¤o:"+STR(year(wingreso),4)
      @ 23,26 SAY "Fecha de mi Retiro  Dia:"+STR(day(fechaliq),2)+"   Mes:"+STR(month(fechaliq),2)+"  A¤o:"+STR(year(fechaliq),4)
      @ 25,26 say "Tiempo de servicio   "+str(wmes,4)+" Meses y "+str(wdias,2)+" Dias"
      @ 27,1  say "SALARIO BASICO : Bs. "+STR(Wbasicodia,8,2)+" DIARIO "
      @ 29,1  say "PREAVISO ....................: "+STR(WBASICODIA,8,2)+" x "+STR(WTPREAVISO,4)+" x "+STR(FFPP,1)+"       Bs. "+STR(BSPREAVISO,10,2)
      @ 31,1  SAY "ANTIGUEDAD LEGAL ........: "+STR(ACUMULADO,10,2)+" / "+STR(DIVIDIR,2)+" x "+STR(WTANTIGUE,7,2)+" x "+STR(FFAA,1)+" Bs. "+STR(BSANTIGUE,10,2)
      @ 33,1  SAY "ANTIGUEDAD CONTRACTUAL ..: "+STR(ACUMULADO,10,2)+" / "+STR(DIVIDIR,2)+" x "+STR(WTANTIGUE2,7,2)+" x "+STR(FFAA,1)+" Bs. "+STR(BSANTIGUE2,10,2)
      @ 33,1  SAY "ANTIGUEDAD ADICIONAL  .................................. Bs.-----------"
      @ 35,1  SAY "CESANTIA ............... : "+STR(ACUMULADO,10,2)+" / "+STR(DIVIDIR,2)+" x "+STR(WTCESANTIA,4)+" x "+STR(FFCC,1)+"    Bs. "+STR(BSCESANTIA,10,2)
      @ 37,1  SAY "CESANTIA ADICIONAL ..................................... Bs.-----------"
      @ 39,1  say "VACACIONES PARCIALES .............:"+STR(WBASICODIA,8,2)+" x "+STR(WTVACACION,6,2)+"---- Bs. "+STR(BSVACACION,10,2)
      @ 41,1  SAY "BONO VACACIONAL ........................................ Bs. "+str(BSBONOVAC,10,2)
      @ 43,1  SAY "INDEMNIZACION MINIMA ................................... Bs. ----------"
      @ 45,1  SAY "EXAMEN DE PRE-EMPLEO Y PRE-RETIRO ..... 1 dia .......... Bs.    "+str(examen,7,2)
      @ 47,1  SAY "TOTAL RECIBIDO EN ESTE ACTO ............................ Bs."+str(wtotalpagar,11,2)
      @ 49,1  SAY "OBSERVACIONES : _______________________________________________________"
      @ 51,1  SAY "_______________________________________________________________________"
      @ 53,1  SAY "TESTIGOS: _____________________________________________________________"
      @ 55,10 SAY "FIRMA DEL TRABAJADOR O A SU RUEGO POR DECIR NO SABER FIRMAR"
      @ 57,30 SAY "____________________"
      SET DEVI TO SCRE
      EJECT

      SELECT 2
      STORE WCEDULA+DTOC(FECHALIQ)+"LIQUI" TO WCLAVEHIST
      FIND &WCLAVEHIST
      IF EOF()
         APPEND BLANK
         REPLACE CEDULA WITH WCEDULA
         REPLACE FECHA WITH FECHALIQ
         REPLACE NOMINA WITH "LIQUI"
      ENDIF
      REPLACE ELABORADA WITH WFECACT
      REPLACE BASICO WITH BASICODIA

      REPLACE  MINIMO     WITH  BSMINIMO
      REPLACE  BONOVAC    WITH  BSBONOVAC
      REPLACE  EXAMEN     WITH  BSEXAMEN
      REPLACE  PREAVISO   WITH  BSPREAVISO
      REPLACE  ANTIGUE    WITH  BSANTIGUE
      REPLACE  ANTIGUE2   WITH  BSANTIGUE2
      REPLACE  CESANTIA   WITH  BSCESANTIA
      REPLACE  VACACION   WITH  BSVACACION
      REPLACE  INDCOM     WITH  BSINDCOM
   ENDIF
RETURN

