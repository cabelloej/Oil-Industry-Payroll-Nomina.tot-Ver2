*********************************************************
*    PROGRAMA PRINCIPAL DE CALCULO DE FIDEICOMISO       *
*********************************************************

SELECT 1
USE IPNPERSO INDEX IPNPERSO
SELECT 2
USE IPNHISTO INDEX IPNHISTO, IPNHIST2
SELECT 5
USE IPNFIDE
SELECT 6
USE IPNOMINA INDEX IPNOMINA
SELECT 10
USE IPNAXP INDEX IPNAXP

STORE "FIDEICOMISO INDIVIDUAL POR A¥O" TO HEADING
STORE .T. TO LIQ
DO WHILE LIQ
   SET EXACT OFF
   SET COLOR TO W+/B
   @ 05,01 CLEAR TO 18,50
   @ 05,01 TO 18,50 DOUBLE
   @ 05,02 SAY HEADING
   @ 07,03 SAY "CEDULA            :"
   @ 09,03 say "NOMBRE            :"
   STORE SPACE(10) TO WCEDULA
   STORE "NUMERO DE CEDULA A PROCESAR" to mes
   DO MENSAJE WITH MES
   @ 7,23 get WCEDULA
   READ
   IF WCEDULA = SPACE(10) .OR. LASTKEY()=27
      CLOSE DATA
      CLOSE INDEX
      SET EXACT ON
      RETURN
   ENDIF
   SELECT 1
   FIND &WCEDULA
   IF EOF()
      STORE "CEDULA NO REGISTRADA" to mes
      do aviso with mes
      loop
   endif
   @ 09,23 SAY RTRIM(NOMBRE)+" "+APELLIDO
   STORE NOMINA   TO WNOMINA
   STORE NOMBRE   TO WNOMBRE
   STORE APELLIDO TO WAPELLIDO
   STORE INGRESO  TO WINGRESO
   STORE RETIRO   TO WRETIRO
   STORE MESFIDE  TO WMESINI
   STORE CONTRATO TO WCONTRATO

   IF WCONTRATO="LDT"
      DO IPNFIDL
   ELSE
      IF WCONTRATO="CONSTRUCCION"
         DO IPNFIDL
      ELSE
         IF WCONTRATO="PETROLERO"
            DO IPNFIDP
         ELSE
            STORE "PERSONA SIN CONTRATO DEFINIDO" TO MES
            DO AVISO WITH MES
            LOOP
         ENDIF
      ENDIF
   ENDIF
      CLOSE DATA
      CLOSE INDEX
      SET EXACT ON
      RETURN

ENDDO



