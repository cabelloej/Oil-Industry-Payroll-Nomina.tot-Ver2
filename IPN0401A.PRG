SAVE SCRE TO WSCREPRE1
select 1
use ipncargos index ipncargos
select 2
use ipncarfa
select 3
use ipnprer  index ipnprer
select 4
use ipnparr  index ipnparr
SELECT 5
USE IPNPETRO
STORE SPACE(6) TO WCODPRE
STORE SPACE(6) TO WCODPAR
STORE SPACE(6) TO WCODCAR
STORE .T. TO WELABORA
DO WHILE WELABORA
   STORE .F. TO WFLAGPRE
   @ 00,00 clear
   @ 00,00 SAY QQWW
   @ 01,00 SAY "PRESUPUESTO DE SUMINISTRO DE PERSONAL POR GASTOS REEMBOLSABLES"
   @ 02,00 say "PRESUPUESTO:"
   @ 03,00 SAY "NOMINA     :"
   @ 04,00 SAY "+-------+------+---------------------------+------+--------+---------+---------+"
   @ 05,00 SAY "|PARTIDA|CARGO |DESCRIPCION                |No.PER|No. DIAS|   SUELDO|     BONO|"
   @ 06,00 SAY "+-------+------+---------------------------+------+--------+---------+---------+"
   STORE "INGRESE CODIGO DEL PRESUP. (IMP)=LISTADO DE PRESUPUESTOS, <ESC>=SALIR" TO MES
   DO MENSAJE WITH MES
   @ 02,12 GET WCODPRE
   READ
   IF READKEY()=12.OR.READKEY()=268.OR.WCODPRE=SPACE(6)
      CLOSE DATA
      CLOSE INDEX
      RESTORE SCRE FROM WSCREPRE1
      RETURN
   ENDIF
   IF WCODPRE = "IMP"
     * DO IPN0402A
      LOOP
   ENDIF
   SELECT 3
   FIND &WCODPRE
   IF EOF()
      STORE "PRESUPUESTO NO REGISTRADO, DESEA INGRESAR ? (S/N)" TO MES
      STORE "S" TO P1
      STORE "N" TO P2
      STORE " " TO RESP
      DO PIDE2 WITH P1,P2,MES,RESP
      STORE RESP TO WSN
      IF WSN = "N"
         LOOP
      ENDIF
      STORE SPACE(60) TO WDESCRI
      STORE SPACE(5)  TO WNOMINA
      @ 2,20 GET WDESCRI
      @ 3,12 GET WNOMINA
      READ
      APPEND BLANK
      REPLACE CODPRE WITH WCODPRE
      REPLACE DESCRI WITH WDESCRI
      REPLACE NOMINA WITH WNOMINA
   ELSE
      STORE DESCRI   TO WDESCRI
      STORE NOMINA   TO WNOMINA
      @ 02,20 SAY WDESCRI
      @ 03,12 SAY WNOMINA
      STORE "OPCIONES: (M)ODIFICAR, (E)LIMINAR, (C)ONTINUAR, (S)ALIR" TO MES
      STORE "M" TO P1
      STORE "E" TO P2
      STORE "C" TO P3
      STORE "S" TO P4
      STORE " " TO RESP
      DO PIDE4 WITH P1,P2,P3,P4,MES,RESP
      STORE RESP TO WMECS
      IF WMECS = "S"
         LOOP
      ENDIF
      IF WMECS = "E"
         STORE "ESTA SEGURO ? (S/N)" TO MES
         STORE "S" TO P1
         STORE "N" TO P2
         STORE " " TO RESP
         DO PIDE2 WITH P1,P2,MES,RESP
         IF RESP = "N"
            LOOP
         ENDIF
         SELECT 3
         DELETE
         SELECT 4
         STORE .T. TO WDEL
         DO WHILE WDEL
            SET EXACT OFF
            FIND &WCODPRE
            SET EXACT ON
            IF EOF()
               EXIT
            ELSE
               DELETE
            ENDIF
         ENDDO
         LOOP
      ENDIF
      IF WMECS = "M"
         STORE "INGRESE LA DESCRIPCION DEL CONTRATO" TO MES
         DO MENSAJE WITH MES
         @ 02,20 GET WDESCRI
         @ 03,12 GET WNOMINA
         READ
         STORE "CONFORME CON DESCRIPCION Y UNIDADES A CONTRATAR ? (S/N)" TO MES
         STORE "S" TO P1
         STORE "N" TO P2
         STORE " " TO RESP
         DO PIDE2 WITH P1,P2,MES,RESP
         STORE RESP TO WC
         IF WC = "N"
            LOOP
         ENDIF
         REPLACE DESCRI WITH WDESCRI
         REPLACE NOMINA WITH WNOMINA
      ENDIF
   ENDIF
   *** PARTIDAS
   STORE .T. TO WVERPAR
   DO WHILE WVERPAR
      STORE 100 TO WLINE
      STORE 0 TO WPAGE
      SELECT 4
      SET EXACT OFF
      FIND &WCODPRE
      SET EXACT ON
      DO WHILE .NOT. EOF() .AND. CODPRE = WCODPRE
         STORE WLINE + 1 TO WLINE
         IF WLINE >=22
            STORE WPAGE + 1 TO WPAGE
            IF WPAGE > 1
               STORE "OPRIMA <ENTER> PARA CONTINUAR VISULIZANDO PARTIDAS, <ESC> PARA TERMINAR" TO MES
               DO AVISO WITH MES
               IF READKEY()=12.OR.READKEY()=268
                  EXIT
               ENDIF
            ENDIF
            @ 07,0 CLEAR
            STORE 7 TO WLINE
         ENDIF
         @ WLINE,01 SAY CODPAR
         @ WLINE,09 SAY CODCAR
         STORE CODCAR TO WCODCAR
         SELECT 1
         FIND &WCODCAR
         IF EOF()
            STORE "NO DEFINIDO EN CARGOS" TO WCARGODES
         ELSE
            STORE DESCRI                  TO WCARGODES
         ENDIF
         SELECT 4
         @ WLINE,16 SAY WCARGODES
         @ WLINE,45 SAY CANTIDAD  PICTURE "###.##"
         @ WLINE,52 SAY DURACION  PICTURE "#####.##"
         @ WLINE,61 SAY FACBASICO PICTURE "######.##"
         @ WLINE,71 SAY FACBONOCO PICTURE "######.##"
         SELECT 4
         SKIP
      ENDDO
      STORE "INGRESE EL CODIGO DE PARTIDA A PROCESAR, <ESC> PARA SALIR" TO MES
      DO MENSAJE WITH MES
      @ 22,1 GET WCODPAR
      READ
      IF WCODPAR = SPACE(6) .OR. READKEY()=12.OR.READKEY()=268
         EXIT
      ENDIF
      STORE WCODPRE+WCODPAR TO WCLAVEPAR
      SELECT 4
      FIND &WCLAVEPAR
      IF EOF()
         *** NO EXISTE LA PARTIDA
         STORE "PARTIDA NO REGISTRADA EN PRESUPUESTO, INGRESAR ? (S/N)" TO MES
         STORE "S" TO P1
         STORE "N" TO P2
         STORE " " TO RESP
         DO PIDE2 WITH P1,P2,MES,RESP
         STORE RESP TO WC
         IF WC = "N"
            LOOP
         ENDIF
         STORE SPACE(6)     TO WCODCAR
         STORE 0            TO WCANTIDAD
         STORE 0            TO WDURACION
         SELECT 2
         STORE FACAYUDA     TO WFACAYUDA
         STORE FACSAL1      TO WFACSAL1
         STORE FACSAL2      TO WFACSAL2
         STORE FACEXAMEN    TO WFACEXAMEN
         STORE NUMEXTRA     TO WNUMEXTRA
         STORE FACEXTRA     TO WFACEXTRA
         STORE FACTV        TO WFACTV
         STORE NUMTV        TO WNUMTV
         STORE FACCESTA     TO WFACCESTA
         STORE FACAH        TO WFACAH
         STORE FACINCE      TO WFACINCE
         STORE FACSPF       TO WFACSPF
         STORE MAXSPF       TO WMAXSPF
         STORE FACSSO       TO WFACSSO
         STORE MAXSSO       TO WMAXSSO
         STORE FACEQUIP     TO WFACEQUIP
         STORE FACUTIL      TO WFACUTIL
         STORE FACIMP       TO WFACIMP
         STORE FACADM       TO WFACADM
         STORE FACUTI       TO WFACUTI
         STORE 0            TO WBSIMP
         STORE 0            TO WBSADM
         STORE 0            TO WBSUTI
         STORE .T. TO WGETCAR
         DO WHILE WGETCAR
            @ 22,9 GET WCODCAR
            READ
            IF WCODCAR = SPACE(6).OR.READKEY()=12.OR.READKEY()=268
               STORE .F. TO WGETCAR
               EXIT
            ENDIF
            SELECT 1
            FIND &WCODCAR
            IF EOF()
               STORE "CARGO NO REGISTRADO, VERIFIQUE" TO MES
               DO AVISO WITH MES
               LOOP
            ENDIF
            STORE DESCRI TO WCARGODES
            STORE SUELDO TO WFACBASICO
            STORE BONOCO TO WFACBONOCO
            @ 22,16 SAY WCARGODES
            @ 22,45 GET WCANTIDAD PICTURE "###.##"
            READ
            IF WCANTIDAD=0.OR.READKEY()=12.OR.READKEY()=268
               LOOP
            ENDIF
            @ 22,52 GET WDURACION PICTURE "#####.##"
            READ
            IF WCANTIDAD=0.OR.READKEY()=12.OR.READKEY()=268
               LOOP
            ENDIF
            @ 22,61 GET WFACBASICO PICTURE "######.##"
            READ
            IF WFACBASICO = 0
               LOOP
            ENDIF
            @ 22,71 GET WFACBONOCO  PICTURE "######.##"
            READ
            EXIT
         ENDDO
         IF .NOT. WGETCAR
            LOOP
         ENDIF
         SAVE SCRE TO WSCREPRE2
         @ 01,00 CLEAR
         @ 01,00 SAY "FACTORES DE LA PARTIDA :"+WCODPAR
         @ 08,5 SAY " AYUDA DE CIUDAD DIARIA :" GET WFACAYUDA
         READ
         @ 09,5 SAY " EXAMEN MEDICO          :" GET WFACEXAMEN
         READ
         @ 10,5 SAY " SALARIO PRE-EMP/PRE-RET:"
         @ 10,31 GET WFACSAL1
         @ 10,34 GET WFACSAL2
         READ
         @ 11,5 SAY " FACTOR TIEMPO DE VIAJE :" GET WFACTV
         READ
         @ 12,5 SAY " No. Hrs. DE  TMP.VIAJE :" GET WNUMTV
         READ
         IF WFACTV > 0 .AND. WNUMTV > 0
            STORE 160 TO WFACEXTRA
         ELSE
            STORE 187 TO WFACEXTRA
         ENDIF
         @ 13,5 SAY " FACTOR DE SOBRETIEMPO  :" GET WFACEXTRA
         READ
         @ 14,5 SAY " No. Hrs. DE SOBRETIEMPO:" GET WNUMEXTRA
         READ
         @ 15,5 SAY " FACTOR CESTA BASICA    :" GET WFACCESTA
         READ
         @ 16,5 SAY " PORC.AHORRO HABITAC.   :" GET WFACAH
         READ
         @ 17,5 SAY " PORCENTAJE INCE        :" GET WFACINCE
         READ
         @ 18,5 SAY " PORC.y MAXIMO DE S.P.F.:"
         @ 18,30 GET WFACSPF PICTURE "##.##"
         @ 18,40 GET WMAXSPF PICTURE "#####.##"
         READ
         @ 19,5 SAY " PORC.y MAXIMO DE S.S.O.:"
         @ 19,30 GET WFACSSO PICTURE "##.##"
         @ 19,40 GET WMAXSSO PICTURE "#####.##"
         READ
         @ 20,5 SAY " Bs.EQUIPOS SEG. TRIMES.:" GET WFACEQUIP
         READ
         @ 21,5 SAY " PORC.UTILIDADES OBRERO :" GET WFACUTIL
         READ
         @ 22,5 SAY " IMPREV,ADMON y UTILIDAD:"
         @ 22,32 GET WFACIMP PICTURE "###.##"
         @ 22,42 GET WFACADM PICTURE "###.##"
         @ 22,52 GET WFACUTI PICTURE "###.##"
         READ
         STORE "CONFORME CON LA INFORMACION DE LA PARTIDA ? (S/N)" TO MES
         STORE "S" TO P1
         STORE "N" TO P2
         STORE " " TO RESP
         DO PIDE2 WITH P1,P2,MES,RESP
         STORE RESP TO WC
         IF WC = "N"
            RESTORE SCRE FROM WSCREPRE2
            LOOP
         ENDIF
         SELECT 4
         APPEND BLANK
         REPLACE CODPRE      WITH WCODPRE
         REPLACE CODPAR      WITH WCODPAR
         REPLACE CODCAR      WITH WCODCAR
         REPLACE CANTIDAD    WITH WCANTIDAD
         REPLACE DURACION    WITH WDURACION
         REPLACE FACBASICO   WITH WFACBASICO
         REPLACE FACBONOCO   WITH WFACBONOCO
         REPLACE FACAYUDA    WITH WFACAYUDA
         REPLACE FACSAL1     WITH WFACSAL1
         REPLACE FACSAL2     WITH WFACSAL2
         REPLACE FACEXAMEN   WITH WFACEXAMEN
         REPLACE NUMEXTRA    WITH WNUMEXTRA
         REPLACE FACEXTRA    WITH WFACEXTRA
         REPLACE NUMTV       WITH WNUMTV
         REPLACE FACTV       WITH WFACTV
         REPLACE FACCESTA    WITH WFACCESTA
         REPLACE FACAH       WITH WFACAH
         REPLACE FACINCE     WITH WFACINCE
         REPLACE FACSPF      WITH WFACSPF
         REPLACE MAXSPF      WITH WMAXSPF
         REPLACE FACSSO      WITH WFACSSO
         REPLACE MAXSSO      WITH WMAXSSO
         REPLACE FACEQUIP    WITH WFACEQUIP
         REPLACE FACUTIL     WITH WFACUTIL
         REPLACE FACIMP      WITH WFACIMP
         REPLACE FACADM      WITH WFACADM
         REPLACE FACUTI      WITH WFACUTI
      ELSE
         STORE "OPCIONES : (M)ODIFICAR, (E)LIMINAR, (S)ALIR" TO MES
         STORE "M" TO P1
         STORE "E" TO P2
         STORE "S" TO P3
         STORE " " TO RESP
         DO PIDE3 WITH P1,P2,P3,MES,RESP
         STORE RESP TO WMES
         IF WMES = "S"
            LOOP
         ENDIF
         IF WMES = "E"
            STORE "ESTA SEGURO ? (S/N)" TO MES
            STORE "S" TO P1
            STORE "N" TO P2
            STORE " " TO RESP
            DO PIDE2 WITH P1,P2,MES,RESP
            STORE RESP TO WSN3
            IF WSN3 = "S"
               DELETE
            ENDIF
            STORE .T. TO WFLAGPRE
            LOOP
         ENDIF
         *** EXISTE LA PARTIDA
         STORE CODCAR       TO WCODCAR
         STORE CANTIDAD     TO WCANTIDAD
         STORE DURACION     TO WDURACION
         STORE FACBASICO    TO WFACBASICO
         STORE FACBONOCO    TO WFACBONOCO
         STORE FACAYUDA     TO WFACAYUDA
         STORE FACSAL1      TO WFACSAL1
         STORE FACSAL2      TO WFACSAL2
         STORE FACEXAMEN    TO WFACEXAMEN
         STORE NUMEXTRA     TO WNUMEXTRA
         STORE FACEXTRA     TO WFACEXTRA
         STORE NUMTV        TO WNUMTV
         STORE FACTV        TO WFACTV
         STORE FACCESTA     TO WFACCESTA
         STORE FACAH        TO WFACAH
         STORE FACINCE      TO WFACINCE
         STORE FACSPF       TO WFACSPF
         STORE MAXSPF       TO WMAXSPF
         STORE FACSSO       TO WFACSSO
         STORE MAXSSO       TO WMAXSSO
         STORE FACEQUIP     TO WFACEQUIP
         STORE FACUTIL      TO WFACUTIL
         STORE FACIMP       TO WFACIMP
         STORE FACADM       TO WFACADM
         STORE FACUTI       TO WFACUTI
         STORE BSIMP        TO WBSIMP
         STORE BSADM        TO WBSADM
         STORE BSUTI        TO WBSUTI
         STORE CODCAR       TO WLATCODCAR
         STORE .T. TO WGETCAR
         DO WHILE WGETCAR
            @ 22,9 GET WCODCAR
            READ
            IF WCODCAR = SPACE(6).OR.READKEY()=12.OR.READKEY()=268
               STORE .F. TO WGETCAR
               EXIT
            ENDIF
            SELECT 1
            FIND &WCODCAR
            IF EOF()
               STORE "CARGO NO REGISTRADO, VERIFIQUE" TO MES
               DO AVISO WITH MES
               LOOP
            ENDIF
            STORE DESCRI TO WCARGODES
            IF WCODCAR <> WLATCODCAR
               STORE SUELDO TO WFACBASICO
               STORE BONOCO TO WFACBONOCO
            ENDIF
            @ 22,16 SAY WCARGODES
            @ 22,45 GET WCANTIDAD PICTURE "###.##"
            READ
            IF WCANTIDAD=0.OR.READKEY()=12.OR.READKEY()=268
               LOOP
            ENDIF
            @ 22,52 GET WDURACION PICTURE "#####.##"
            READ
            IF WCANTIDAD=0.OR.READKEY()=12.OR.READKEY()=268
               LOOP
            ENDIF
            @ 22,61 GET WFACBASICO PICTURE "######.##"
            READ
            IF WFACBASICO = 0
               LOOP
            ENDIF
            @ 22,71 GET WFACBONOCO  PICTURE "######.##"
            READ
            EXIT
         ENDDO
         IF .NOT. WGETCAR
            LOOP
         ENDIF
         SAVE SCRE TO WSCREPRE2
         @ 01,00 CLEAR
         @ 01,00 SAY "FACTORES DE LA PARTIDA :"+WCODPAR
         @ 08,5 SAY " AYUDA DE CIUDAD DIARIA :" GET WFACAYUDA
         READ
         @ 09,5 SAY " EXAMEN MEDICO          :" GET WFACEXAMEN
         READ
         @ 10,5 SAY " SALARIO PRE-EMP/PRE-RET:"
         @ 10,31 GET WFACSAL1
         @ 10,34 GET WFACSAL2
         READ
         @ 11,5 SAY " FACTOR TIEMPO DE VIAJE :" GET WFACTV
         READ
         @ 12,5 SAY " No. Hrs. DE  TMP.VIAJE :" GET WNUMTV
         READ
         IF WFACTV > 0 .AND. WNUMTV > 0
            STORE 160 TO WFACEXTRA
         ELSE
            STORE 187 TO WFACEXTRA
         ENDIF
         @ 13,5 SAY " FACTOR DE SOBRETIEMPO  :" GET WFACEXTRA
         READ
         @ 14,5 SAY " No. Hrs. DE SOBRETIEMPO:" GET WNUMEXTRA
         READ
         @ 15,5 SAY " FACTOR CESTA BASICA    :" GET WFACCESTA
         READ
         @ 16,5 SAY " PORC.AHORRO HABITAC.   :" GET WFACAH
         READ
         @ 17,5 SAY " PORCENTAJE INCE        :" GET WFACINCE
         READ
         @ 18,5 SAY " PORC.y MAXIMO DE S.P.F.:"
         @ 18,30 GET WFACSPF PICTURE "##.##"
         @ 18,40 GET WMAXSPF PICTURE "#####.##"
         READ
         @ 19,5 SAY " PORC.y MAXIMO DE S.S.O.:"
         @ 19,30 GET WFACSSO PICTURE "##.##"
         @ 19,40 GET WMAXSSO PICTURE "#####.##"
         READ
         @ 20,5 SAY " Bs.EQUIPOS SEG. TRIMES.:" GET WFACEQUIP
         READ
         @ 21,5 SAY " PORC.UTILIDADES OBRERO :" GET WFACUTIL
         READ
         @ 22,5 SAY " IMPREV,ADMON y UTILIDAD:"
         @ 22,32 GET WFACIMP PICTURE "###.##"
         READ
         IF WFACIMP = 0
            STORE "INGRESE EL MONTO DIRECTO EN BOLIVARES PARA IMPREVISTOS" TO MES
            DO MENSAJE WITH MES
            @ 22,32 GET WBSIMP PICTURE "#######.##"
            READ
         ENDIF
         @ 22,42 GET WFACADM PICTURE "###.##"
         READ
         IF WFACADM = 0
            STORE "INGRESE EL MONTO DIRECTO EN BOLIVARES PARA ADMINISTRACION" TO MES
            DO MENSAJE WITH MES
            @ 22,42 GET WBSADM PICTURE "#######.##"
            READ
         ENDIF
         @ 22,52 GET WFACUTI PICTURE "###.##"
         READ
         IF WFACUTI = 0
            STORE "INGRESE EL MONTO DIRECTO EN BOLIVARES PARA UTILIDAD" TO MES
            DO MENSAJE WITH MES
            @ 22,52 GET WBSUTI PICTURE "#######.##"
            READ
         ENDIF
         STORE "CONFORME CON LA INFORMACION DE LA PARTIDA ? (S/N)" TO MES
         STORE "S" TO P1
         STORE "N" TO P2
         STORE " " TO RESP
         DO PIDE2 WITH P1,P2,MES,RESP
         STORE RESP TO WC
         IF WC = "N"
            RESTORE SCRE FROM WSCREPRE2
            LOOP
         ENDIF
         SELECT 4
         REPLACE CODCAR      WITH WCODCAR
         REPLACE CANTIDAD    WITH WCANTIDAD
         REPLACE DURACION    WITH WDURACION
         REPLACE FACBASICO   WITH WFACBASICO
         REPLACE FACBONOCO   WITH WFACBONOCO
         REPLACE FACAYUDA    WITH WFACAYUDA
         REPLACE FACSAL1     WITH WFACSAL1
         REPLACE FACSAL2     WITH WFACSAL2
         REPLACE FACEXAMEN   WITH WFACEXAMEN
         REPLACE NUMEXTRA    WITH WNUMEXTRA
         REPLACE FACEXTRA    WITH WFACEXTRA
         REPLACE NUMTV       WITH WNUMTV
         REPLACE FACTV       WITH WFACTV
         REPLACE FACCESTA    WITH WFACCESTA
         REPLACE FACAH       WITH WFACAH
         REPLACE FACINCE     WITH WFACINCE
         REPLACE FACSPF      WITH WFACSPF
         REPLACE MAXSPF      WITH WMAXSPF
         REPLACE FACSSO      WITH WFACSSO
         REPLACE MAXSSO      WITH WMAXSSO
         REPLACE FACEQUIP    WITH WFACEQUIP
         REPLACE FACUTIL     WITH WFACUTIL
         REPLACE FACIMP      WITH WFACIMP
         REPLACE FACADM      WITH WFACADM
         REPLACE FACUTI      WITH WFACUTI
         REPLACE BSIMP       WITH WBSIMP
         REPLACE BSADM       WITH WBSADM
         REPLACE BSUTI       WITH WBSUTI
      ENDIF
      *** CALCULA LA PARTIDA PROCESADA

      STORE INT(WDURACION/30) TO WMESESFULL
      STORE INT(WDURACION/30) TO WMESES
      STORE INT(WDURACION/7)  TO WSEMANAS
      STORE (WFACBASICO)*30   TO WSALBAMES

      *** SALARIO BASICO
      STORE WFACBASICO*30        TO WSALMES
      STORE WDURACION*WFACBASICO TO WTOTSALBAS
   
      *** BONO COMPENSATORIO
      STORE WFACBONOCO*30   TO WMESBONO
      STORE WMESBONO*WMESES TO WTOTBONO
   
      *** AYUDA DE CIUDAD
      STORE WFACAYUDA*30     TO WMESAYUDA
      STORE WMESAYUDA*WMESES TO WTOTAYUDA
   
      *** TIEMPO DE VIAJE
      STORE ((((WFACBASICO+WFACBONOCO)/8)*WFACTV)/100) TO WDIATV
      STORE WDIATV*WNUMTV TO WTOTTV

      *** ESTIMACION DE LABOR EXTRA
      STORE WNUMEXTRA TO WHREXTRA
      IF WTOTTV > 0
         STORE ((WFACBASICO+WFACBONOCO+WFACAYUDA+WDIATV)/8)*(WFACEXTRA/100) TO Wbsextra
      ELSE
         STORE ((WFACBASICO+WFACBONOCO)/8)*(WFACEXTRA/100) TO Wbsextra
      ENDIF
      STORE (Wbsextra*whrextra) TO WTOTEXTRA
      IF WTOTEXTRA > 0
         STORE WTOTEXTRA/WDURACION TO WEXTEJC
      ELSE
         STORE 0 TO WEXTEJC
      ENDIF

      *** BONO DE TRANSPORTE
      IF WSALMES > 45000
         STORE 0    TO WMESBONOTRA
      ELSE
         STORE 3000 TO WMESBONOTRA
      ENDIF
      STORE WMESBONOTRA*WMESES TO WTOTBONOTRA

      *** BONO ALIMENTICIO
      IF WSALMES > 45000
         STORE 0    TO WMESBONOALI
      ELSE
         STORE 3000 TO WMESBONOALI
      ENDIF
      STORE WMESBONOALI*WMESES TO WTOTBONOALI

      *** EXAMEN PRE EMPLEO
      STORE WFACEXAMEN TO WTOTEXAMEN

      *** SALARIO EXAMEN PRE EMPLEO
      STORE WFACBASICO+WFACBONOCO TO WTOTSE1
      IF WFACSAL1<>"S"
         STORE 0 TO WTOTSE1
      ENDIF

      *** EXAMEN PRE RETIRO
      STORE WFACEXAMEN TO WTOTEXAMEN

      *** SALARIO EXAMEN PRE RETIRO
      STORE WFACBASICO+WFACBONOCO TO WTOTSE2
      IF WFACSAL2<>"S"
         STORE 0 TO WTOTSE2
      ENDIF

      SELECT 5
      GO TOP
      LOCATE FOR meses > WMESES
      IF .NOT. FOUND()
         STORE "ERROR, NO ENCONTRE LOS MESES DE PRESTACIONES APROPIADOS" TO MES
         DO AVISO WITH MES
         CLOSE DATA
         CLOSE INDEX
         RETURN TO MASTER
      ENDIF
      GO RECNO()-1
      STORE PREAVISO TO WTPREAVISO
      STORE ANTIGUEDAD TO WTANTIGUE
      STORE CESANTIA TO WTCESANTIA
      STORE VACACION TO WTVACACION
      STORE UTILIDAD TO WTUTILIDAD
      STORE TOTAL TO WTTOTAL
      STORE GARANTIA TO WTGARANTIA
      STORE 2.5*(WFACBASICO+WFACBONOCO)*WMESES TO WNETOVAC
      STORE (BONOVAC/WMESES)/30  TO WBONODIA
      IF WMESESFULL >= 3
         *** BONO VACACIONAL
         STORE WNETOVAC  TO WTOTBONOVAC
         *** UTILIDADES
         STORE ((WTOTSALBAS+WTOTBONO+WTOTAYUDA+WTOTEXTRA+WTOTTV+WTOTBONOVAC)*WFACUTIL)/100 TO WTOTUTIL
         *** PREAVISO
         STORE WTPREAVISO*(WFACBASICO+WFACBONOCO+WFACAYUDA) TO WTOTPREAVI
         *** ANTIGUEDAD
         STORE ((WTOTSALBAS+WTOTBONO+WTOTAYUDA+WTOTEXTRA+WTOTTV+WTOTBONOVAC+WTOTUTIL)/WMESES)/30 TO WDIAANTI
         STORE WTANTIGUE*WDIAANTI TO WTOTANTI
         *** CESANTIA
         STORE ((WTOTSALBAS+WTOTBONO+WTOTAYUDA+WTOTEXTRA+WTOTTV+WTOTBONOVAC+WTOTUTIL)/WMESES)/30 TO WDIACESAN
         STORE WTCESANTIA*WDIACESAN TO WTOTCESAN
         *** VACACION
         STORE WTVACACION*(WFACBASICO+WFACBONOCO+WFACAYUDA+WDIATV) TO WTOTVACA
         *** INDEN. MINIMA
         STORE 0 TO WTOTMINIMA
      ELSE
         *** BONO VACACIONAL
         STORE WNETOVAC  TO WTOTBONOVAC
         *** UTILIDADES
         STORE ((WTOTSALBAS+WTOTBONO+WTOTAYUDA+WTOTEXTRA+WTOTTV+WTOTBONOVAC)*WFACUTIL)/100 TO WTOTUTIL
         *** PREAVISO
         STORE 0  TO WTOTPREAVI
         *** ANTIGUEDAD
         STORE 0 TO WDIAANTI
         STORE 0 TO WTOTANTI
         *** CESANTIA
         STORE 0 TO WDIACESAN
         STORE 0 TO WTOTCESAN
         *** VACACION
         STORE 0 TO WTOTVACA
         *** INDEN.MINIMA
         STORE ((WTOTSALBAS+WTOTBONO)*0.333) TO WTOTMINIMA
         STORE 0 TO WTPREAVISO
         STORE 0 TO WTANTIGUE
         STORE 0 TO WTCESANTIA
         STORE 0 TO WTVACACION
         STORE UTILIDAD TO WTUTILIDAD
         STORE TOTAL TO WTTOTAL
         STORE GARANTIA TO WTGARANTIA
         store bonovac to wnetovac
         STORE (BONOVAC/WMESES)/30  TO WBONODIA
      ENDIF

      STORE WTOTSALBAS+WTOTBONO+WTOTAYUDA+WTOTEXTRA+WTOTTV+WTOTBONOTRA+WTOTBONOALI+ ;
            WTOTEXAMEN+WTOTSE1+WTOTEXAMEN+WTOTSE2+WTOTBONOVAC+WTOTUTIL+WTOTPREAVI + ;
            WTOTANTI+WTOTCESAN+WTOTVACA+WTOTMINIMA TO WSUBTOTA

      IF WFACIMP > 0
         STORE WSUBTOTA*(WFACIMP/100) TO WTOTIMP
      ELSE
         STORE WBSIMP                 TO WTOTIMP
      ENDIF
      STORE WTOTIMP                   TO WBSIMP

      STORE WSUBTOTA+WTOTIMP TO WSUBTOTB

      *** LEY DE POLITICA HABITACIONAL
      STORE ((WSALBAMES+WMESBONO)*WFACAH)/100 TO WMESAH
      STORE WMESAH*WMESES TO WTOTAH

      *** INCE
      STORE ((WFACBASICO+WFACBONOCO+WFACAYUDA+WEXTEJC+WDIATV)*WFACINCE)/100 TO WDIAINCE
      STORE WDIAINCE*30 TO WMESINCE
      STORE WDIAINCE*WDURACION TO WTOTINCE

      *** SPF
      STORE ((WFACBASICO+WFACBONOCO+WFACAYUDA)*WFACSPF)/100 TO WDIASPF
      STORE WDIASPF*30 TO WSEMSPF
      IF WSEMSPF > WMAXSPF
         STORE WMAXSPF TO WSEMSPF
      ENDIF
      STORE WSEMSPF*WMESES TO WTOTSPF

      *** SSO
      STORE ((WFACBASICO+WFACBONOCO+WFACAYUDA)*WFACSSO)/100 TO WDIASSO
      STORE WDIASSO*30 TO WSEMSSO
      IF WSEMSSO > WMAXSSO
         STORE WMAXSSO TO WSEMSSO
      ENDIF
      STORE WSEMSSO*WMESES  TO WTOTSSO

      *** EQUIPOS DE SEGURIDAD
      STORE WMESES/3 TO WMESEQUIP
      IF WMESEQUIP - INT(WMESEQUIP) > 0
         STORE INT(WMESEQUIP)+1 TO WMESEQUIP
      ENDIF
      STORE WMESEQUIP*WFACEQUIP TO WTOTEQUIP

      *** CESTA BASICA
      STORE WMESES*WFACCESTA TO WTOTCESTA

      STORE WSUBTOTB+WTOTEQUIP+WTOTCESTA+WTOTAH+WTOTINCE+WTOTSPF+WTOTSSO TO WTOTGEN

      IF WFACADM>0
         STORE (WTOTGEN*WFACADM)/100    TO WTOTADM
      ELSE
         STORE WBSADM                   TO WTOTADM
      ENDIF
      STORE WTOTADM                     TO WBSADM
      STORE WTOTGEN+WTOTADM             TO WSUBTOTC
      IF WFACUTI > 0
         STORE (WSUBTOTC*WFACUTI)/100   TO WTOTUTI
      ELSE
         STORE WBSUTI                   TO WTOTUTI
      ENDIF
      STORE WTOTUTI                     TO WBSUTI
      STORE WSUBTOTC+WTOTUTI            TO WTOTOFE

      *** GRABA RESULTADOS DEL ANALISIS
      SELECT 4
      REPLACE MESES        WITH WMESES
      REPLACE CASALBAS     WITH WDURACION
      REPLACE CUSALBAS     WITH WFACBASICO
      REPLACE BSSALBAS     WITH WTOTSALBAS
      REPLACE CABONOCO     WITH WMESES
      REPLACE CUBONOCO     WITH WMESBONO
      REPLACE BSBONOCO     WITH WTOTBONO
      REPLACE CAAYUDA      WITH WMESES
      REPLACE CUAYUDA      WITH WMESAYUDA
      REPLACE BSAYUDA      WITH WTOTAYUDA
      REPLACE CATV         WITH WNUMTV
      REPLACE CUTV         WITH WDIATV
      REPLACE BSTV         WITH WTOTTV
      REPLACE CAST         WITH WHREXTRA
      REPLACE CUST         WITH WBSEXTRA
      REPLACE BSST         WITH WTOTEXTRA
      REPLACE CABT         WITH WMESES
      REPLACE CUBT         WITH WMESBONOTRA
      REPLACE BSBT         WITH WTOTBONOTRA
      REPLACE CABA         WITH WMESES
      REPLACE CUBA         WITH WMESBONOALI
      REPLACE BSBA         WITH WTOTBONOALI
      REPLACE CAEXA1       WITH 1
      REPLACE CUEXA1       WITH WFACEXAMEN
      REPLACE BSEXA1       WITH WTOTEXAMEN
      REPLACE CASALEXA1    WITH 1
      REPLACE CUSALEXA1    WITH WFACBASICO+WFACBONOCO
      REPLACE BSSALEXA1    WITH WTOTSE1
      REPLACE CAEXA2       WITH 1
      REPLACE CUEXA2       WITH WFACEXAMEN
      REPLACE BSEXA2       WITH WTOTEXAMEN
      REPLACE CASALEXA2    WITH 1
      REPLACE CUSALEXA2    WITH WFACBASICO+WFACBONOCO
      REPLACE BSSALEXA2    WITH WTOTSE2
      REPLACE CABV         WITH WMESES
      REPLACE CUBV         WITH 2.5*(WFACBASICO+WFACBONOCO)
      REPLACE BSBV         WITH WTOTBONOVAC
      REPLACE CAUTIL       WITH 1
      REPLACE CUUTIL       WITH 0
      REPLACE BSUTIL       WITH WTOTUTIL
      REPLACE CAPREAVI     WITH WTPREAVISO
      REPLACE CUPREAVI     WITH WFACBASICO+WFACBONOCO+WFACAYUDA
      REPLACE BSPREAVI     WITH WTOTPREAVI
      REPLACE CAINDEM      WITH WTANTIGUE
      REPLACE CUINDEM      WITH WDIAANTI
      REPLACE BSINDEM      WITH WTOTANTI
      REPLACE CACAUSA      WITH WTCESANTIA
      REPLACE CUCAUSA      WITH WDIACESAN
      REPLACE BSCAUSA      WITH WTOTCESAN
      REPLACE CAVACA       WITH WTVACACION
      REPLACE CUVACA       WITH WFACBASICO+WFACBONOCO+WFACAYUDA
      REPLACE BSVACA       WITH WTOTVACA
      REPLACE CAMINI       WITH 0
      REPLACE CUMINI       WITH 0
      REPLACE BSMINI       WITH WTOTMINIMA
      REPLACE SUBTOTA      WITH WSUBTOTA
      REPLACE BSIMP        WITH WBSIMP
      REPLACE SUBTOTB      WITH WSUBTOTB
      REPLACE CACESTA      WITH WMESES
      REPLACE CUCESTA      WITH WFACCESTA
      REPLACE BSCESTA      WITH WTOTCESTA
      REPLACE CAEQUIP      WITH WMESEQUIP
      REPLACE CUEQUIP      WITH WFACEQUIP
      REPLACE BSEQUIP      WITH WTOTEQUIP
      REPLACE CALAH        WITH WMESES
      REPLACE CULAH        WITH WMESAH
      REPLACE BSLAH        WITH WTOTAH
      REPLACE CAINCE       WITH WMESES
      REPLACE CUINCE       WITH WMESINCE
      REPLACE BSINCE       WITH WTOTINCE
      REPLACE CASPF        WITH WMESES
      REPLACE CUSPF        WITH WSEMSPF
      REPLACE BSSPF        WITH WTOTSPF
      REPLACE CASSO        WITH WMESES
      REPLACE CUSSO        WITH WSEMSSO
      REPLACE BSSSO        WITH WTOTSSO
      REPLACE BSTOTLAB     WITH WTOTGEN
      REPLACE BSADM        WITH WBSADM
      REPLACE SUBTOTC      WITH WSUBTOTC
      REPLACE BSUTI        WITH WBSUTI
      REPLACE BSTOTPAR     WITH WTOTOFE
      STORE "DESEA IMPRIMIR EL ANALISIS DE LA PARTIDA ? (S/N)" TO MES
      STORE "S" TO P1
      STORE "N" TO P2
      STORE " " TO RESP
      DO PIDE2 WITH P1,P2,MES,RESP
      IF RESP = "S"
         SELECT 4
         DO PAR0401
      ENDIF
      RESTORE SCRE FROM WSCREPRE2
      STORE .T. TO WFLAGPRE
   ENDDO
ENDDO

