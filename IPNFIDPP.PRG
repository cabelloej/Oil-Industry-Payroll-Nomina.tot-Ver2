   STORE 0 TO WBASICO,WBONOCOM,WAYUCIU
   IF WNOMINA <> SPACE(5)
      SELECT IPNOMINA
      FIND &WNOMINA
      IF EOF()
         STORE "NO REISTRADA EN MAESTRO" TO WDESNOM,WNOCONTRA
      ELSE
         STORE DESNOM   TO WDESNOM
         STORE CONTRATO TO WNOCONTRA
      ENDIF
   ELSE
      STORE "PERSONAL SIN NOMINA" TO WDESNOM,WNOCONTRA
   ENDIF

   SELECT 7
   USE
   SELECT IPNHISTO
   COPY STRU TO IPNSHIT
   SELECT 7
   USE IPNSHIT
   INDEX ON CEDULA+SUBSTR(DTOC(FECHA),7,4)+SUBSTR(DTOC(FECHA),4,2)+SUBSTR(DTOC(FECHA),1,2) TO IPNSHIT
   APPEND FROM IPNHISTO FOR CEDULA = WCEDULA

   STORE 0   TO WTOTFIDE
   STORE 0   TO WSUBTOT
   STORE 100 TO WLINE
   SET DEVI  TO PRINT

   IF WCONTRATO = "PETROLERO"
      STORE "IPNPETRO" TO WFILE
   ENDIF
   IF WCONTRATO = "LDT"
      STORE "IPNLDT"   TO WFILE
   ENDIF
   IF WCONTRATO = "CONSTRUCCION"
      STORE "IPNCONST" TO WFILE
   ENDIF
   IF WCONTRATO = "PEQUIVEN"
      STORE "IPNPEQUI" TO WFILE
   ENDIF

   STORE VAL(SUBSTR(DTOC(WINGRESO),1,2))      TO WDD
   STORE VAL(SUBSTR(DTOC(WINGRESO),4,2))      TO WMM
   *IF WFLAGACT
      *STORE VAL(SUBSTR(DTOC(WINGRESO),7,4))+1 TO WYY
   *ELSE
      *STORE VAL(SUBSTR(DTOC(WINGRESO),7,4))   TO WYY
      STORE VAL(SUBSTR(DTOC(WINGRESO),7,4))+1  TO WYY
   *ENDIF
   STORE STR(WDD,2)+"-"+STR(WMM,2)+"-"+STR(WYY,4)      TO WFECINI
   STORE CTOD(WFECINI) TO WFECINI
   STORE .F. TO WRECTIFICO
   DO WHILE WFECINI = CTOD("  -  -    ")
      STORE WDD - 1 TO WDD
      STORE STR((WDD),2)+"-"+STR(WMM,2)+"-"+STR(WYY,4) TO WFECINI
      STORE CTOD(WFECINI) TO WFECINI
   ENDDO
   STORE day(WFECINI) TO WFIRSTWDD
   STORE .F. TO WRECTIFICO
   SELECT 4
   USE &wfile

   *STORE "INGRESO: "+DTOC(WINGRESO)+" FECINI :"+DTOC(WFECINI)+"  RETIRO: "+DTOC(WRETIRO)  TO MES
   *SET DEVI TO SCRE
   *DO AVISO WITH MES
   

   DO WHILE WFECINI < WRETIRO
      IF .NOT. WRECTIFICO
         STORE VAL(SUBSTR(DTOC(WFECINI),1,2)) TO WDD
         STORE VAL(SUBSTR(DTOC(WFECINI),4,2)) TO WMM
         STORE VAL(SUBSTR(DTOC(WFECINI),7,4)) TO WYY
      ELSE
         STORE WFIRSTWDD                      TO WDD
         STORE VAL(SUBSTR(DTOC(WFECINI),4,2)) TO WMM
         STORE VAL(SUBSTR(DTOC(WFECINI),7,4)) TO WYY
      ENDIF
      STORE WMM+1 TO WMM
      IF WMM > 12
         STORE WYY+1 TO WYY
         STORE 1 TO WMM
      ENDIF
      STORE STR(WDD,2)+"-"+STR(WMM,2)+"-"+STR(WYY,4) TO WFECINI
      STORE CTOD(WFECINI) TO WFECINI
      STORE .F. TO WRECTIFICO
      DO WHILE WFECINI = CTOD("  -  -    ")
         STORE .T. TO WRECTIFICO
         STORE WDD-1 TO WDD
         STORE STR((WDD),2)+"-"+STR(WMM,2)+"-"+STR(WYY,4) TO WFECINI
         STORE CTOD(WFECINI) TO WFECINI
      ENDDO
      STORE WMESNO + 1 TO WMESNO
      STORE MONTH(WFECINI) TO WMESPROC
      STORE YEAR(WFECINI)  TO WYEARPROC
      SELECT 4
      GO TOP
      LOCATE FOR meses > WMESNO
      IF .NOT. FOUND()
         SET DEVI TO SCRE
         STORE "NO ENCONTRE LOS MESES CORRESP."+STR(WMESNO,3)+" FECHA INIC:"+DTOC(WFECINI) TO MES
         DO AVISO WITH MES
         RETURN
      ENDIF
      GO RECNO()-1
      STORE ANTIGUEDAD TO WANT

      SELECT IPNSHIT
      SEEK WCEDULA
      IF .NOT. FOUND()
         SET DEVI TO SCRE
         STORE "NO HAY HISTORICOS PARA "+WCEDULA TO MES
         DO AVISO WITH MES
         RETURN
      ENDIF
      DO WHILE .NOT. EOF() .AND. CEDULA = WCEDULA
         IF NOMINA = "UTLDA" .OR. NOMINA = "LIQUI"
            SELECT IPNSHIT
            SKIP
            LOOP
         ENDIF
         IF MONTH(FECHA) = WMESPROC .AND. YEAR(FECHA) = WYEARPROC
            IF BASICO >0
               STORE BASICO TO WBASICO
            ENDIF
            IF BSBONOCOM > 0 .AND. HRBONOCOM > 0
               STORE (BSBONOCOM/HRBONOCOM)*8 TO WBONOCOM
            ELSE
               IF DESOCB1="BC".AND.BSOCB1>0.AND.HROCB1>0
                  STORE (BSOCB1/HROCB1)*8 TO WBONOCOM
               ELSE
                  IF DESOCB2 = "BC" .AND.BSOCB2>0.AND.HROCB2>0
                     STORE (BSOCB2/HROCB2)*8 TO WBONOCOM
                  ELSE
                     IF DESOCB3 = "BC" .AND.BSOCB3>0.AND.HROCB3>0
                        STORE (BSOCB3/HROCB3)*8 TO WBONOCOM
                     ENDIF
                  ENDIF
               ENDIF
            ENDIF
            IF BSAYUCIU > 0 .AND. HRAYUCIU >0
               STORE (BSAYUCIU/HRAYUCIU)*8   TO WAYUCIU
            ENDIF
            STORE FECHA               TO WFECHAHIS
         ENDIF
         SKIP
      ENDDO

      SELECT IPNFIDE
      GO TOP
      LOCATE FOR ANO = WYEARPROC .AND. MEZ = WMESPROC
      IF .NOT. FOUND()
         SET DEVI TO SCRE
         STORE "TABLA DE INTERESES NO CONTIENE A¥O:"+STR(WYEARPROC,4)+" MES:"+STR(WMESPROC,2) TO MES
         DO AVISO WITH MES
         RETURN
      ELSE
         STORE INTERES TO WINTERESES
         STORE WINTERESES/12 TO WINTMES
      ENDIF

      STORE WBASICO+WBONOCOM+WAYUCIU TO WSUELDO
      STORE WANT*WSUELDO             TO WTOTPRES
      STORE WTOTPRES*WINTMES/100     TO WTOTMES

      *** MES A MES
      IF WMESNO>=WMESINI .AND. WMESNO<=WMESFIN
         IF WFLAGACT
            STORE WLINE+1 TO WLINE
            IF WLINE>55
               DO SALTO
            ENDIF
            @ WLINE,1  SAY WFECINI
            @ WLINE,14 SAY WMESNO      PICTURE "###"
            @ WLINE,23 SAY WSUELDO     PICTURE "######.##"
            @ WLINE,34 SAY WTOTPRES    PICTURE "#########.##"
            @ WLINE,48 SAY WINTERESES  PICTURE "##.##"
            @ WLINE,59 SAY WINTMES     PICTURE "##.##"
            @ WLINE,70 SAY WTOTMES     PICTURE "#########.##"
         ENDIF
         STORE WTOTFIDE+WTOTMES TO WTOTFIDE
         STORE WSUBTOT+WTOTMES  TO WSUBTOT

         *** SUBTOTAL ANUAL
         IF WFLAGACT
            IF ((WMESNO/12)-INT(WMESNO/12)=0) .AND. WMESNO <> 12
               STORE WLINE+1 TO WLINE
               @ WLINE,0 SAY REPLICATE("-",80)
               STORE WLINE+1 TO WLINE
               @ WLINE,48 SAY "SALDO AL MES "+STR(WMESNO,3)+"  Bs.:"
               @ WLINE,70 SAY WSUBTOT     PICTURE "#########.##"
               STORE 0 TO WSUBTOT
            ENDIF
         ENDIF
      ENDIF
   ENDDO

   *** TOTAL FINAL
   IF WFLAGACT
      STORE WLINE + 1 TO WLINE
      IF WLINE>55
         DO SALTO
      ENDIF
      @ WLINE, 1 SAY "T O T A L   F I D E I C O M I S O   Bs.:"
      @ WLINE,70 SAY WTOTFIDE     PICTURE "#########.##"
      STORE "------------------------------------" TO WX1
      STORE RTRIM(WAPELLIDO)+" "+WNOMBRE TO WX2
      STORE WCEDULA  TO WX3
      @ 54,40-(LEN(WX1)/2) SAY WX1
      @ 55,40-(LEN(WX2)/2) SAY WX2
      @ 56,40-(LEN(WX3)/2) SAY WX3
      SELECT 1
      REPLACE MESFIDE WITH WMESFIN
      EJECT
   ENDIF

   SET DEVI TO SCRE
   RETURN

   *************
   PROC SALTO
   *************
   @ 0,0 SAY CHR(14)+QQWW
   @ 1,60 SAY "FECHA:"+DTOC(WFECACT)
   @ 2,0 SAY "CALCULO DE FIDEICOMISO"
   @ 4,0 SAY "CEDULA :"+WCEDULA+"        APELLIDOS Y NOMBRES:"+RTRIM(WAPELLIDO)+" "+WNOMBRE
   @ 6,0 SAY "NOMINA :"+WNOMINA+"-"+WDESNOM
   @ 8,0 say  "CONTRATO No.:"+WNOCONTRA+"   INGRESO:"+DTOC(WINGRESO)+"  "+" CORTE AL:"+DTOC(WRETIRO)
   @ 10,00 SAY "+----------+--------+-----------+-------------+----------+----------+-------------+"
   @ 11,00 SAY "| FECHA    |No.MESES| SB+BC+AC  | PRESTACIONES|  %INTERES| INT.MENS.|    TOTAL MES|"
   @ 12,00 SAY "+----------+--------+-----------+-------------+----------+----------+-------------+"
   STORE 13 TO WLINE
   RETURN
