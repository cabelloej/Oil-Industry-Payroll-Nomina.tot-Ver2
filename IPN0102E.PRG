PUSH KEY CLEAR
ON KEY LABEL F1 DO PROCIMP

SELECT 1
USE IPNFIDE
STORE 0 TO WANO
STORE 0 TO WMEZ
STORE 0 TO WINTERES
STORE .T. TO WW
DO WHILE WW
   SET COLOR TO W+/B
   @ 04,00 SAY "INTERESES DE FIDEICOMISO"
   @ 05,00 CLEAR TO 20,79
   @ 05,00 TO 20,79 DOUBLE
   @ 08,05 SAY "A¥O   :"
   @ 10,05 SAY "MES   :"
   @ 12,05 SAY "% INT.:"
   STORE "A¥O A PROCESAR, F1=VER, <ENTER>=SALIR" TO MES
   DO MENSAJE WITH MES
   @ 08,14 GET WANO PICTURE "####" 
   READ
   IF WANO = 0 .OR. READKEY()=12.OR.READKEY()=268
      EXIT
   ENDIF
   @ 10,14 GET WMEZ PICTURE "##" 
   READ
   LOCATE FOR  ANO = WANO .AND. MEZ = WMEZ
   IF EOF()
      STORE "PERIODO NO REGISTRADO, INGRESAR ? (S/N)" TO MES
      STORE "S" TO P1
      STORE "N" TO P2
      STORE " " TO RESP
      DO PIDE2 WITH P1,P2,MES,RESP
      IF RESP = "N"
         LOOP
      ENDIF
      APPEND BLANK
      REPLACE ANO WITH WANO
      REPLACE MEZ WITH WMEZ
      @ 12,14 GET INTERES PICTURE "###.##"
      READ
      SORT TO IPNFIDE.BAK ON ANO,MEZ
      ZAP
      APPEND FROM IPNFIDE.BAK
      LOOP
   ELSE
      @ 12,14 SAY INTERES PICTURE "###.##"
      STORE "OPCIONES: (M)ODIFICAR, (E)LIMINAR, (S)ALIR" TO MES
      STORE "M" TO P1
      STORE "E" TO P2
      STORE "S" TO P3
      STORE " " TO RESP
      DO PIDE3 WITH P1,P2,P3,MES,RESP
      IF RESP = "S"
         LOOP
      ENDIF
      IF RESP = "E"
         DELETE
      ENDIF
      IF RESP = "M"
         @ 12,14 GET INTERES PICTURE "###.##"
         READ
      ENDIF
   ENDIF
ENDDO
POP KEY
SET COLOR TO
CLOSE DATA
CLOSE INDEX
RETURN

************
PROC PROCIMP
************
SAVE SCRE TO WSCREIMP
STORE "OPCIONES: (M)ONITOR, (I)MPRESORA, (S)ALIR" to mess
store "M" TO P1
STORE "I" TO P2
STORE "S" TO P3
STORE " " TO RESP
DO PIDE3 WITH P1, P2, P3, MESS, RESP
STORE "" TO WSALIDA
IF RESP = "M"
   STORE 20  TO WSALTO
   STORE "M" TO WSALIDA
   SET DEVI  TO SCRE
ELSE
   IF RESP = "I"
      STORE 55  TO WSALTO
      STORE "I" TO WSALIDA
      SET DEVI  TO PRINT
   ENDIF
ENDIF
*
IF RESP<>"S"
   STORE 100 TO WLINE
   STORE 0   TO WPAGE
   GO TOP
   DO WHILE .NOT. EOF()
      STORE WLINE+1 TO WLINE
      IF WLINE>=WSALTO
         DO HEADER
      ENDIF
      @ WLINE,00 SAY ANO     PICT "9999"
      @ WLINE,20 SAY MEZ     PICT "99"
      @ WLINE,40 SAY INTERES PICT "999.9999"
      SKIP
   ENDDO
ENDIF
IF WSALIDA="M"
   STORE "OPRIMA <ENTER> PARA FINALIZAR" TO MES
   DO AVISO WITH MES
ELSE
   IF WSALIDA = "I"
      EJECT
   ENDIF
ENDIF
SET DEVI TO SCRE
REST SCRE FROM WSCREIMP
RETURN
************
PROC HEADER
************
STORE WPAGE+1 TO WPAGE
IF WSALIDA="M"
   IF WPAGE>1
      STORE "OPRIMA <ENTER> PARA CONTINUAR" TO MES
      DO AVISO WITH MES
   ENDIF
   @ 0,0 CLEAR
ENDIF
IF LASTKEY()=27
   GO BOTT
ENDIF
@ 00,00 SAY QQWW
@ 00,60 SAY "FECHA  : "+DTOC(DATE())
@ 01,00 SAY "SISTEMA DE NOMINA"
@ 01,60 SAY "PAGINA : "+STR(WPAGE,2)
@ 02,00 SAY "LISTADO DE INTERESES BANCARIOS"
@ 04,00 SAY "A¥O"
@ 04,20 SAY "MES"
@ 04,40 SAY "INTESES"
@ 05,00 SAY "---"
@ 05,20 SAY "---"
@ 05,40 SAY "-------"
STORE 06 TO WLINE
RETURN




