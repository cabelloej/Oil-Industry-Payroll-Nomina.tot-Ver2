PUSH KEY CLEAR
ON KEY LABEL F1 DO PROCIMP

SELECT 1
USE IPNAXP INDEX IPNAXP
SELECT 2
USE IPNPERSO INDEX IPNPERSO

STORE .T. TO DOIT
DO WHILE DOIT
   STORE "ANTICIPO DE PRESTACIONES"  TO HEAD
   SET COLOR TO W+/B
   @ 5,0 CLEAR TO 15,79
   @ 5,0 TO 15,79 DOUBLE
   @ 5,40- (LEN(HEAD)/2) SAY HEAD
   @ 07,5 SAY   "CEDULA     :"
   @ 09,5 SAY   "FECHA      :"
   @ 11,5 SAY   "MONTO      :"
   @ 13,5 SAY   "REFERENCIA :"

   @ 9,17 SAY SPACE(30)
   STORE "CEDULA, F1=VER, <ENTER>=SALIR" TO MES
   DO MENSAJE WITH MES
   STORE SPACE(10) TO WCODIGO
   STORE WFECACT   TO WFECHA
   @ 7,17 GET WCODIGO
   READ
   IF WCODIGO = SPACE(10)
      SET COLOR TO
      POP KEY
      CLOSE DATA
      CLOSE INDEX
      RETURN
   ENDIF
   SELECT 2
   SEEK WCODIGO
   IF .NOT. FOUND()
      STORE "CEDULA NO REGISTRADA, VERIFIQUE" TO MES
      DO AVISO WITH MES
      LOOP
   ENDIF
   @ 07, 30 SAY RTRIM(APELLIDO)+", "+NOMBRE

   @ 9,17 GET WFECHA
   READ
   IF WFECHA = CTOD("  -  -    ")
      SET COLOR TO
      POP KEY
      CLOSE DATA
      CLOSE INDEX
      RETURN
   ENDIF
   SELECT 1
   STORE WCODIGO+DTOS(WFECHA) TO WCLAVE
   SEEK WCLAVE
   IF .NOT. FOUND()
      STORE "PRESTAMO NO REGISTRADO. DESEA INGRESAR ? (S/N)" TO MES
      STORE "S" TO P1
      STORE "N" TO P2
      STORE " " TO RESP
      DO PIDE2 WITH P1,P2,MES,RESP
      IF RESP = "N"
         LOOP
      ENDIF
      APPEND BLANK
      REPLACE CEDULA WITH WCODIGO
      REPLACE FECHA  WITH WFECHA
      @ 11,17 GET MONTO PICT "999,999,999.99"
      @ 13,17 GET REFERENCIA
      READ
   ELSE
      @ 11,17 SAY MONTO PICT "999,999,999.99"
      @ 13,17 SAY REFERENCIA
      STORE "OPCIONES: (M)ODIFICAR, (E)LIMINAR, (S)ALIR" TO MES
      STORE "S" TO P1
      STORE "M" TO P2
      STORE "E" TO P3
      STORE " " TO RESP
      DO PIDE3 WITH P1,P2,P3,MES,RESP
      IF RESP = "S"
         LOOP
      ENDIF
      IF RESP = "M"
         @ 11,17 GET MONTO PICT "999,999,999.99"
         @ 13,17 GET REFERENCIA
         READ
      ENDIF
      IF RESP = "E"
        DELETE
        PACK
      ENDIF
   ENDIF
ENDDO
************
PROC PROCIMP
************
SAVE SCRE TO WSCREIMP
@ 6,1 CLEAR TO 10,20
@ 6,1       TO 10,20
@ 6,4 SAY "VER ANTICIPO"
@ 8,2 SAY "CEDULA:"
STORE SPACE(10) TO WCODIGO
@ 8,9 GET WCODIGO
READ
STORE "OPCIONES: (M)ONITOR, (I)MPRESORA, (S)ALIR" to mess
store "M" TO P1
STORE "I" TO P2
STORE "S" TO P3
STORE " " TO RESP
DO PIDE3 WITH P1, P2, P3, MESS, RESP
STORE "" TO WSALIDA
IF RESP = "M"
   STORE 20  TO WSALTO
   STORE "M" TO WSALIDA
   SET DEVI  TO SCRE
ELSE
   IF RESP = "I"
      STORE 55  TO WSALTO
      STORE "I" TO WSALIDA
      SET DEVI  TO PRINT
   ENDIF
ENDIF
*
IF RESP<>"S"
   STORE 100 TO WLINE
   STORE 0   TO WPAGE
   GO TOP
   DO WHILE .NOT. EOF()
      STORE WLINE+1 TO WLINE
      IF WLINE>=WSALTO
         DO HEADER
      ENDIF
      @ WLINE,00 SAY CEDULA
      @ WLINE,15 SAY FECHA 
      @ WLINE,30 SAY MONTO PICT "999999999.99"
      @ WLINE,45 SAY REFERENCIA
      SKIP
   ENDDO
ENDIF
IF WSALIDA="M"
   STORE "OPRIMA <ENTER> PARA FINALIZAR" TO MES
   DO AVISO WITH MES
ELSE
   IF WSALIDA = "I"
      EJECT
   ENDIF
ENDIF
SET DEVI TO SCRE
REST SCRE FROM WSCREIMP
RETURN
************
PROC HEADER
************
STORE WPAGE+1 TO WPAGE
IF WSALIDA="M"
   IF WPAGE>1
      STORE "OPRIMA <ENTER> PARA CONTINUAR" TO MES
      DO AVISO WITH MES
   ENDIF
   @ 0,0 CLEAR
ENDIF
IF LASTKEY()=27
   GO BOTT
ENDIF
@ 00,00 SAY QQWW
@ 00,60 SAY "FECHA  : "+DTOC(DATE())
@ 01,00 SAY "SISTEMA DE NOMINA"
@ 01,60 SAY "PAGINA : "+STR(WPAGE,2)
@ 02,00 SAY "ANTICIPO DE PRESTACIONES"
@ 04,00 SAY "CEDULA"
@ 04,15 SAY "FECHA"
@ 04,30 SAY "MONTO"
@ 04,45 SAY "REFERENCIA"

@ 05,00 SAY "----------"
@ 05,15 SAY "----------"
@ 05,30 SAY "-------------"
@ 05,45 SAY "---------------------"
STORE 06 TO WLINE
RETURN
