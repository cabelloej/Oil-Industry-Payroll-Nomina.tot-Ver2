PUSH KEY CLEAR
ON KEY LABEL F1 DO PROCIMP

*******************************************************
******    MANTENIMIENTO HISTORICO PERSONAL    *********
*******************************************************
SELECT 1
USE IPNHISTO INDEX IPNHISTO, IPNHIST2 ALIAS HISTORICO
SELECT 2
USE IPNPERSO INDEX IPNPERSO
SELECT 1
store .t. to hist
store "MANTENIMIENTO HISTORICO PERSONAL" TO HEADING
DO WHILE HIST
   SET COLOR TO W+/B
   @ 00,00 CLEAR
   @ 00,00 SAY QQWW
   @ 01,00 SAY HEADING
   @ 02,02 SAY "CEDULA :"
   @ 02,30 SAY "FECHA DE PAGO :"
   @ 02,65 SAY "NOMINA :"
   @ 03,02 SAY "SUELDO BASICO:"
   @ 04,01 SAY REPLICATE("-",78)
   @ 05,01 SAY "DESCRIPCION                       CANTIDAD      BOLIVARES  TURNO"
   @ 06,01 SAY "--------------------------------  --------  -------------  -----"
   STORE SPACE(10) TO WCEDULA
   @ 2,10 GET WCEDULA
   READ
   IF WCEDULA = SPACE(10)
      POP KEY
      SET COLOR TO
      CLOSE DATA
      CLOSE INDEX
      RETURN
   ENDIF
   SELECT 2
   FIND &WCEDULA
   IF EOF()
      STORE "ERROR, CEDULA NO REGISTRADA, VERIFIQUE..." TO MES
      DO AVISO WITH MES
      LOOP
   ENDIF
   STORE CTOD("  -  -    ") TO WFECHA
   @ 2,45 GET WFECHA
   READ
   STORE SPACE(5) TO WNOMINA
   @ 2,73 GET WNOMINA
   READ
   STORE WCEDULA+dtoc(WFECHA)+WNOMINA TO WCLAVE
   SELECT 1
   FIND &WCLAVE
   IF EOF()
      STORE "Historico no registrado para esta cedula en esta fecha, ingresar ? (S/N)" TO MESS
      store "S" TO P1
      STORE "N" TO P2
      STORE " " TO RESP
      DO PIDE2 WITH P1,P2,MESS,RESP
      IF RESP = "S"
         APPEND BLANK
         REPLACE CEDULA WITH WCEDULA
         REPLACE FECHA WITH WFECHA
         REPLACE NOMINA WITH WNOMINA
      ELSE
         LOOP
      ENDIF
   ELSE
      STORE "OPCIONES: (M)ODIFICAR, (E)LIMINAR, (R)ECHAZAR" TO MES
      STORE "M" TO P1
      STORE "R" TO P2
      STORE "E" TO P3
      STORE " " TO RESP
      DO PIDE3 WITH P1,P2,P3,MES,RESP
      STORE RESP TO WMER
      IF WMER = "R"
         LOOP
      ELSE
         IF WMER = "E"
            STORE "ESTA SEGURO ? (S/N) " TO MES
            STORE "S" TO P1
            STORE "N" TO P2
            STORE " " TO RESP
            DO PIDE2 WITH P1,P2,MES,RESP
            IF RESP = "S"
               SELECT 1
               IF DESOCB1="V"
                  STORE BSOCB1 TO WMONTOVAC
                  SELECT 2
                  REPLACE UTILACUM WITH UTILACUM - WMONTOVAC
                  SELECT 1
               ENDIF
               DELETE
            ENDIF
            LOOP
         ENDIF
      ENDIF
   ENDIF
    
   @ 07,02 SAY "LABOR ORDINARIA DIURNA        "
   @ 08,02 SAY "LABOR ORDINARIA MIXTA         "
   @ 09,02 SAY "LABOR ORDINARIA NOCTURNA      "
   @ 10,02 SAY "SOBRE TIEMPO DIURNO DE 3 HRS. "
   @ 11,02 SAY "SOBRE TIEMPO DIURNO DE +3 HRS."
   @ 12,02 SAY "SOBRE TIEMPO MIXTO  DE 3 HRS. "
   @ 13,02 SAY "SOBRE TIEMPO MIXTO  DE +3 HRS."
   @ 14,02 SAY "SOBRE TIEMPO NOCT.  DE 3 HRS. "
   @ 15,02 SAY "SOBRE TIEMPO NOCT.  DE +3 HRS."
   @ 16,02 SAY "SOBRE TIEMPO GUARDIA MIXTA    "
   @ 17,02 SAY "SOBRE TIEMPO GUARDIA NOCTURNA "
   @ 03,19 GET BASICO
   @ 07,35 GET HRORDD   PICTURE "#####.##"
   @ 07,45 GET BSORDD   PICTURE "#######.##"
   @ 08,35 GET HRORDM   PICTURE "#####.##"
   @ 08,45 GET BSORDM   PICTURE "#######.##"
   @ 09,35 GET HRORDN   PICTURE "#####.##"
   @ 09,45 GET BSORDN   PICTURE "#######.##"
   @ 10,35 GET HRSTDA   PICTURE "#####.##"
   @ 10,45 GET BSSTDA   PICTURE "#######.##"
   @ 11,35 GET HRSTDB   PICTURE "#####.##"
   @ 11,45 GET BSSTDB   PICTURE "#######.##"
   @ 12,35 GET HRSTMA   PICTURE "#####.##"
   @ 12,45 GET BSSTMA   PICTURE "#######.##"
   @ 13,35 GET HRSTMB   PICTURE "#####.##"
   @ 13,45 GET BSSTMB   PICTURE "#######.##"
   @ 14,35 GET HRSTNA   PICTURE "#####.##"
   @ 14,45 GET BSSTNA   PICTURE "#######.##"
   @ 15,35 GET HRSTNB   PICTURE "#####.##"
   @ 15,45 GET BSSTNB   PICTURE "#######.##"
   @ 16,35 GET HRSTGM   PICTURE "#####.##"
   @ 16,45 GET BSSTGM   PICTURE "#######.##"
   @ 17,35 GET HRSTGN   PICTURE "#####.##"
   @ 17,45 GET BSSTGN   PICTURE "#######.##"
   READ
   @ 07,00 CLEAR
   @ 07,02 SAY "TIEMPO DE VIAJE DIURNO DE  1.5"
   @ 08,02 SAY "TIEMPO DE VIAJE DIURNO DE +1.5"
   @ 09,02 SAY "TIEMPO DE VIAJE MIXTO  DE  1.5"
   @ 10,02 SAY "TIEMPO DE VIAJE MIXTO  DE +1.5"
   @ 11,02 SAY "TIEMPO DE VIAJE NOCT.  DE  1.5"
   @ 12,02 SAY "TIEMPO DE VIAJE NOCT.  DE +1.5"
   @ 13,02 SAY "DESCANSO NORMAL        DE +1.5"
   @ 14,02 SAY "DESCANSO CONTRACTUAL TRABAJADO"
   @ 15,02 SAY "DESCANSO LEGAL TRABAJADO      "
   @ 16,02 SAY "DESCANSO COMPENSATORIO        "
   @ 17,02 SAY "AYUDA DE CIUDAD               "
   @ 18,02 SAY "COMIDAS                       "
   @ 19,02 SAY "REPOSO-COMIDA                 "
   @ 20,02 SAY "FERIADOS                      "
   @ 07,35 GET HRTVDA   PICTURE "#####.##"
   @ 07,45 GET BSTVDA   PICTURE "#######.##"
   @ 08,35 GET HRTVDB   PICTURE "#####.##"
   @ 08,45 GET BSTVDB   PICTURE "#######.##"
   @ 09,35 GET HRTVMA   PICTURE "#####.##"
   @ 09,45 GET BSTVMA   PICTURE "#######.##"
   @ 10,35 GET HRTVMB   PICTURE "#####.##"
   @ 10,45 GET BSTVMB   PICTURE "#######.##"
   @ 11,35 GET HRTVNA   PICTURE "#####.##"
   @ 11,45 GET BSTVNA   PICTURE "#######.##"
   @ 12,35 GET HRTVNB   PICTURE "#####.##"
   @ 12,45 GET BSTVNB   PICTURE "#######.##"
   @ 13,35 GET HRDESNOR PICTURE "#####.##"
   @ 13,45 GET BSDESNOR PICTURE "#######.##"
   @ 14,35 GET HRDESCON PICTURE "#####.##"
   @ 14,45 GET BSDESCON PICTURE "#######.##"
   @ 14,62 GET CTDESCON
   @ 15,35 GET HRDESLEG PICTURE "#####.##"
   @ 15,45 GET BSDESLEG PICTURE "#######.##"
   @ 15,62 GET CTDESLEG
   @ 16,35 GET HRDESCOM PICTURE "#####.##"
   @ 16,45 GET BSDESCOM PICTURE "#######.##"
   @ 17,35 GET HRAYUCIU PICTURE "#####.##"
   @ 17,45 GET BSAYUCIU PICTURE "#######.##"
   @ 18,35 GET HRCOMIDA PICTURE "#####.##"
   @ 18,45 GET BSCOMIDA PICTURE "#######.##"
   @ 19,35 GET HRREPCOM PICTURE "#####.##"
   @ 19,45 GET BSREPCOM PICTURE "#######.##"
   @ 20,35 GET HRFERIADO PICTURE "#####.##"
   @ 20,45 GET BSFERIADO PICTURE "#######.##"
   READ
   @ 07,00 CLEAR
   @ 07,02 SAY "BONO NOCTURNO TRABAJADO       "
   @ 08,02 SAY "BONO NOCTURNO DE VIAJE        "
   @ 09,02 SAY "BONO NOCTURNO DE GUARDIA      "
   @ 10,02 SAY "BONO DOMINICAL                "
   @ 11,02 SAY "PRIMA POR FERIADO             "
   @ 12,02 SAY "BONO COMPENSATORIO            "
   @ 13,02 SAY "OTROS CONCEPTOS BONIFICABLES  "
   @ 14,02 SAY "OTROS CONCEPTOS BONIFICABLES  "
   @ 15,02 SAY "BONO ALIMENTICIO              "
   @ 16,02 SAY "BONO DE TRANSPORTE            "
   @ 17,02 SAY "CESTA BASICA                  "
   @ 18,02 SAY "VIVIENDA                      "
   @ 19,02 SAY "UTILIDADES PARCIALES (OBR.EV.)"
   @ 20,02 SAY "INDEMNIZACION MINIMA (OBR.EV.)"
   @ 21,02 SAY "OROS CONCEPTOS NO BONIFICABLES"
   @ 22,02 SAY "OROS CONCEPTOS NO BONIFICABLES"
   @ 07,35 GET HRBN      PICTURE "#####.##"
   @ 07,45 GET BSBN      PICTURE "#######.##"
   @ 08,35 GET HRBNV     PICTURE "#####.##"
   @ 08,45 GET BSBNV     PICTURE "#######.##"
   @ 09,35 GET HRBNG     PICTURE "#####.##"
   @ 09,45 GET BSBNG     PICTURE "#######.##"
   @ 10,35 GET HRBD      PICTURE "#####.##"
   @ 10,45 GET BSBD      PICTURE "#######.##"
   READ


   SAVE SCRE TO WSCREFER
   STORE .T. TO WVERFER
   DO WHILE WVERFER
      @ 11,35 GET HRFERPRI  PICTURE "#####.##"
      @ 11,45 GET BSFERPRI  PICTURE "#######.##"
      READ
      IF BSFERPRI > 0
         @ 12,01 CLEAR TO 16,79
         @ 12,01       TO 16,79
         @ 13,02 SAY "FERIADOS TRAB. TURNO DIURNO:     DIA NORMAL:    DIA DESCANSO:"
         @ 13,32 GET FERPRID PICTURE "#"
         @ 13,48 GET FTDNOR  PICTURE "#"
         @ 13,65 GET FTDDES  PICTURE "#"
         READ
         IF FERPRID<>FTDNOR+FTDDES
            LOOP
         ENDIF
         @ 14,02 SAY "FERIADOS TRAB. TURNO MIXTO :     DIA NORMAL:    DIA DESCANSO:"
         @ 14,32 GET FERPRIM PICTURE "#"
         @ 14,48 GET FTMNOR  PICTURE "#"
         @ 14,65 GET FTMDES  PICTURE "#"
         READ
         IF FERPRIM<>FTMNOR+FTMDES
            LOOP
         ENDIF
         @ 15,02 SAY "FERIADOS TRAB. TURNO NOCT. :     DIA NORMAL:    DIA DESCANSO:"
         @ 15,32 GET FERPRIN PICTURE "#"
         @ 15,48 GET FTNNOR  PICTURE "#"
         @ 15,65 GET FTNDES  PICTURE "#"
         READ
         IF FERPRIN<>FTNNOR+FTNDES
            LOOP
         ENDIF
         IF (HRFERPRI/4) <> FERPRID+FERPRIM+FERPRIN
            LOOP
         ENDIF
      ENDIF
      EXIT
   ENDDO
   RESTORE SCRE FROM WSCREFER
   @ 11,35 SAY HRFERPRI  PICTURE "#####.##"
   @ 11,45 SAY BSFERPRI  PICTURE "#######.##"

   @ 12,35 GET HRBONOCOM PICTURE "#####.##"
   @ 12,45 GET BSBONOCOM PICTURE "#######.##"
   @ 13,35 GET DESOCB1
   @ 13,45 GET BSOCB1    PICTURE "#######.##"
   @ 14,35 GET DESOCB2
   @ 14,45 GET BSOCB2    PICTURE "#######.##"
  *@ 15,35 GET HRBONOALIM PICTURE "#####.##"
   @ 15,45 GET BSBONOALIM PICTURE "#######.##"
  *@ 16,35 GET HRBONOTRAN PICTURE "#####.##"
   @ 16,45 GET BSBONOTRAN PICTURE "#######.##"
  *@ 17,35 GET HRCESTA    PICTURE "#####.##"
   @ 17,45 GET BSCESTA    PICTURE "#######.##"
  *@ 18,35 GET HRVIVE     PICTURE "#####.##"
   @ 18,45 GET BSVIVE     PICTURE "#######.##"
  *@ 19,35 GET HRUTILIDAD PICTURE "#####.##"
   @ 19,45 GET BSUTILIDAD PICTURE "#######.##"
  *@ 20,35 GET HRINDEMNIZ PICTURE "#####.##"
   @ 20,45 GET BSINDEMNIZ PICTURE "#######.##"
   @ 21,35 GET DESOCNB1
   @ 21,45 GET BSOCNB1    PICTURE "#######.##"
   @ 22,35 GET DESOCNB2
   @ 22,45 GET BSOCNB2    PICTURE "#######.##"
   READ
   @ 07,00 CLEAR
   @ 07,02 SAY "IMPUESTO SOBRE LA RENTA       "
   @ 08,02 SAY "SEGURO SOCIAL OBLIGATORIO     "
   @ 09,02 SAY "SEGURO DE PARO FORZOSO        "
   @ 10,02 SAY "LEY DE AHORRO HABITACIONAL    "
   @ 11,02 SAY "APORTE SINDICAL               "
   @ 12,02 SAY "APORTE A CAJA DE AHORROS      "
   @ 13,02 SAY "PRESTAMOS                     "
   @ 14,02 SAY "OTRAS DEDUCCIONES             "
   @ 15,02 SAY "OTRAS DEDUCCIONES             "
   @ 07,45 GET BSISLR     PICTURE "#######.##"
   @ 08,45 GET BSSSO      PICTURE "#######.##"
   @ 09,45 GET BSSPF      PICTURE "#######.##"
   @ 10,45 GET BSAHRHAB   PICTURE "#######.##"
   @ 11,45 GET BSSINDIC   PICTURE "#######.##"
   @ 12,45 GET BSCAJA     PICTURE "#######.##"
   @ 13,45 GET BSPRESPER  PICTURE "#######.##"
   @ 14,35 GET DESOD1
   @ 14,45 GET BSOD1      PICTURE "#######.##"
   @ 15,35 GET DESOD2
   @ 15,45 GET BSOD2      PICTURE "#######.##"
   READ
   REPLACE HRORD WITH HRORDD+HRORDM+HRORDN
   REPLACE BSORD WITH BSORDD+BSORDM+BSORDN
   REPLACE HRST  WITH HRSTDA+HRSTDB+HRSTMA+HRSTMB+HRSTNA+HRSTNB
   REPLACE BSST  WITH BSSTDA+BSSTDB+BSSTMA+BSSTMB+BSSTNA+BSSTNB
   REPLACE HRTV  WITH HRTVDA+HRTVDB+HRTVMA+HRTVMB+HRTVNA+HRTVNB
   REPLACE BSTV  WITH BSTVDA+BSTVDB+BSTVMA+BSTVMB+BSTVNA+BSTVNB
   REPLACE BSTOTBON WITH BSORDD+BSORDM+BSORDN+BSSTDA+BSSTDB+BSSTMA+BSSTMB+BSSTNA+BSSTNB+BSSTGM+BSSTGN+;
           BSTVDA+BSTVDB+BSTVMA+BSTVMB+BSTVNA+BSTVNB+BSDESNOR+BSDESCON+BSDESLEG+BSDESCOM+;
           BSAYUCIU+BSCOMIDA+BSREPCOM+BSFERIADO+BSBN+BSBNV+BSBNG+BSBD+BSFERPRI+BSBONOCOM+BSOCB1+BSOCB2
   REPLACE BSTOTNBON WITH BSBONOTRAN+BSBONOALIM+BSCESTA+BSVIVE+BSUTILIDAD+BSINDEMNIZ+;
                         BSOCNB1+BSOCNB2
   REPLACE BSTOTDEC  WITH BSISLR+BSSSO+BSSPF+BSAHRHAB+BSSINDIC+BSCAJA+BSPRESPER+BSOD1+BSOD2
ENDDO


************
PROC PROCIMP
************
SAVE SCRE TO WSCREIMP
STORE "OPCIONES: (M)ONITOR, (I)MPRESORA, (S)ALIR" to mess
store "M" TO P1
STORE "I" TO P2
STORE "S" TO P3
STORE " " TO RESP
DO PIDE3 WITH P1, P2, P3, MESS, RESP
STORE "" TO WSALIDA
IF RESP = "M"
   STORE 20  TO WSALTO
   STORE "M" TO WSALIDA
   SET DEVI  TO SCRE
ELSE
   IF RESP = "I"
      STORE 55  TO WSALTO
      STORE "I" TO WSALIDA
      SET DEVI  TO PRINT
   ENDIF
ENDIF
*
IF RESP<>"S"
   STORE 100 TO WLINE
   STORE 0   TO WPAGE
   GO TOP
   DO WHILE .NOT. EOF().AND. NOMINA<>"LIQUI"
      STORE WLINE+1 TO WLINE
      IF WLINE>=WSALTO
         DO HEADER
      ENDIF
      @ WLINE,00 SAY CEDULA
      @ WLINE,15 SAY FECHA
      @ WLINE,30 SAY NOMINA
      SKIP
   ENDDO
ENDIF
IF WSALIDA="M"
   STORE "OPRIMA <ENTER> PARA FINALIZAR" TO MES
   DO AVISO WITH MES
ELSE
   IF WSALIDA = "I"
      EJECT
   ENDIF
ENDIF
SET DEVI TO SCRE
REST SCRE FROM WSCREIMP
RETURN
************
PROC HEADER
************
STORE WPAGE+1 TO WPAGE
IF WSALIDA="M"
   IF WPAGE>1
      STORE "OPRIMA <ENTER> PARA CONTINUAR" TO MES
      DO AVISO WITH MES
   ENDIF
   @ 0,0 CLEAR
ENDIF
IF LASTKEY()=27
   GO BOTT
ENDIF
@ 00,00 SAY QQWW
@ 00,60 SAY "FECHA  : "+DTOC(DATE())
@ 01,00 SAY "SISTEMA DE NOMINA"
@ 01,60 SAY "PAGINA : "+STR(WPAGE,2)
@ 02,00 SAY "LISTADO DE HISTORICO DE PAGO"
@ 04,00 SAY "CEDULA"
@ 04,15 SAY "FECHA"
@ 04,30 SAY "NOMINA"
@ 05,00 SAY "------------"
@ 05,15 SAY "------------"
@ 05,30 SAY "------"
STORE 06 TO WLINE
RETURN


