return
SELECT 1
USE IPNPERSO INDEX IPNPERSO
SELECT 2
USE IPNHISTO INDEX IPNHISTO, IPNHIST2 ALIAS IPNHISTO
SELECT 5
USE IPNFIDE
SELECT 6
USE IPNOMINA INDEX IPNOMINA

STORE .T. TO UTIL
DO WHILE UTIL
   SET DEVI TO SCRE
   SET COLOR TO W+/B
   @ 5,0 CLEAR TO 16,50
   @ 5,0 TO 16,50 DOUBLE
   STORE "RESUMEN ANUAL DE FIDEICOMISO" TO HEADING
   @ 5,25-(LEN(HEADING)/2) SAY HEADING
   STORE SPACE(5) TO WNOMRES
   STORE "INGRESE LA NOMINA A ESTIMAR. ENTER=TODAS, ESC=SALIR" TO MES
   DO MENSAJE WITH MES
   @ 8,2 SAY "NOMINA :" GET WNOMRES
   READ
   IF WNOMRES=SPACE(5).OR.LASTKEY()=27         
      EXIT
   ENDIF
   STORE .F. TO WFLAGACT
   STORE 100 TO LINE
   STORE 0   TO WTOTREP
   SELECT IPNPERSO
   GO TOP
   DO WHILE .NOT. EOF()
      IF WNOMRES<>SPACE(5).AND.WNOMRES<>NOMINA
         SELECT IPNPERSO
         SKIP
         LOOP
      ENDIF
      IF NOMINA=SPACE(5)
         SELECT IPNPERSO
         SKIP
         LOOP
      ENDIF
      STORE CEDULA     TO WCEDULA
      STORE NOMINA     TO WNOMINA
      STORE NOMBRE     TO WNOMBRE
      STORE APELLIDO   TO WAPELLIDO
      STORE CONTRATO   TO WCONTRATO
      STORE INGRESO    TO WINGRESO
      STORE WFECACT    TO WRETIRO
      STORE 0          TO WMESINI
      STORE 12         TO WMESFIN
      STORE 0          TO WMESNO
      STORE 0          TO WTOTFIDE
      
      SELECT IPNHISTO
      SEEK WCEDULA
      DO WHILE .NOT. EOF() .AND. CEDULA=WCEDULA
         IF NOMINA="LIQUI" .AND. FECHA > WINGRESO
            STORE FECHA TO WINGRESO
         ENDIF
         SKIP
      ENDDO

      SELECT IPNOMINA
      FIND &WNOMINA
      IF EOF()
         STORE "Error, nomina "+WNOMINA+" de cedula "+wcedula+" no esta registrada" TO MES
         DO AVISO WITH MES
         SELECT IPNPERSO
         SKIP
         LOOP
      ENDIF
    
      DO IPNFIDE
      DO IMPLIN
      STORE WTOTREP + WTOTFIDE TO WTOTREP
         
      SELECT IPNPERSO
      SKIP
   ENDDO
   SET DEVI TO PRINT
   STORE LINE + 2 TO LINE
   @ line,126 SAY str(WTOTREP,11,2)
   SET DEVI TO SCRE
   EJECT
ENDDO
CLOSE DATA
CLOSE INDEX
RETURN
***************
PROCEDURE SALTO
***************
SET DEVI TO PRINT
@ 1,00 SAY CHR(18)+CHR(14)+QQWW
@ 2,00 SAY "RESUMEN ANUAL DE FIDEICOMISO AL "+DTOC(WFECACT)
@ 3,00 SAY "NOMINA "+WNOMRES

@ 06,00  SAY "CEDULA"
@ 06,11  SAY "NOMBRE Y APELLIDO"
@ 06,35  SAY "DESDE     "
@ 06,47  SAY "HASTA     "
@ 06,60  SAY "NETO PAGAR"
STORE 08 TO LINE
RETURN
*****************
PROCEDURE IMPLIN
*****************
SET DEVI TO PRINT
STORE LINE+1 TO LINE
IF LINE>55
   DO SALTO
ENDIF
@ line,00  SAY wcedula
@ line,11  SAY rtrim(wapellido)+", "+wnombre
@ line,35  SAY wingreso
@ line,47  SAY wretiro 
@ line,60  SAY str(wtotfide,9,2)
SET DEVI TO SCRE
RETURN
