***************************************
* LIQUIDACION PETROLERA               *
***************************************
IF WMOTIVO = "TERMINACION"
    STORE 1 TO FFPP
    STORE 1 TO FFCC
    STORE 1 TO FFAA
ELSE
    IF WMOTIVO = "RENUNCIA"
       STORE 1 TO FFPP
       STORE 1 TO FFCC
       STORE 1 TO FFAA
    ELSE
       STORE 2 TO FFPP
       STORE 2 TO FFCC
       STORE 2 TO FFAA
    ENDIF
ENDIF

IF WMES < 3
   ** 
   STORE 0 TO WTPREAVISO
   STORE 0 TO WTANTIGUE
   STORE 0 TO WTANTIGUE2
   STORE 0 TO WTCESANTIA
   STORE 0 TO WTVACACION
   STORE 0 TO WNETOVAC, WTBONOVAC
   STORE 0 TO WTUTILIDAD
   STORE 0 TO WTTOTAL
   STORE 0 TO WTGARANTIA
   STORE 0 TO WTBONANTI
   STORE 0 TO BSANTIGUE2
   STORE 0 TO WDIASEJC
   STORE 0 TO BSUTILANTI
   STORE 0 TO BSBONOANTI
   **
   SELECT 4
   USE IPNOMINA
   LOCATE FOR CODNOM = WNOMINA
   IF .NOT. FOUND()
      STORE "ERROR, LA NOMINA DE ESTA PERSONA NO ESTA REGISTRADA" TO MES
      DO AVISO WITH MES
      USE
      RETURN
   ENDIF
   STORE FACTCOD TO WFACTCOD
   STORE DESNOM  TO WDESCRINOM
   STORE LUGAR   TO WLUGAR
   SELECT 4
   USE IPNFACTO
   LOCATE FOR FACCOD = WFACTCOD
   IF .NOT. FOUND()
      STORE "ERROR, LOS FACTORES DE ESTA NOMINA NO ESTA REGISTRADOS" TO MES
      DO AVISO WITH MES
      USE
      RETURN
   ENDIF
   STORE (WSUELDO+WBONOCO) TO WbasicoEJC
   STORE (WSUELDO+WBONOCO) TO Wbasicodia
   STORE WBASICODIA TO VARIABLE
   DO REDONDEO WITH VARIABLE
   STORE VARIABLE TO WBASICODIA
   STORE ROUND(WBASICODIA,2) TO WBASICODIA

   STORE (WSUELDO+WBONOCO) TO EXAMEN
   STORE EXAMEN TO VARIABLE
   DO REDONDEO WITH VARIABLE
   STORE VARIABLE TO EXAMEN
   STORE ROUND(EXAMEN,2) TO EXAMEN

   STORE wbasicodia * .333 TO WPORDIA
   STORE WPORDIA TO VARIABLE
   DO REDONDEO WITH VARIABLE
   STORE VARIABLE TO WPORDIA
   STORE ROUND(WPORDIA,2) TO WPORDIA

   STORE WPORDIA*WTOTDIAS TO WTOTALLIQ

   STORE SPACE(35) TO QQWW
   DO INFORMA WITH QQWW
   IF QQWW <> T3
      CLOSE DATA
      CLOSE INDEX
      STORE "ERROR DE INSTALACION" TO MES
      DO AVISO WITH MES
      RETURN
   ENDIF

   store 0 to wnetovac, WTBONOVAC
   SELECT 4
   USE IPNpetro
   GO TOP
   LOCATE FOR meses > wmes
   IF .NOT. FOUND()
      STORE "ERROR, "+WCEDULA+" TABLA DE LIQUIDACION SIN MESES APROPIADOS" TO MES
      DO AVISO WITH MES
      CLOSE DATA
      CLOSE INDEX
      RETURN TO MASTER
   ENDIF
   IF RECNO()>1
      GO RECNO()-1
   ENDIF
   store bonovac to wnetovac, WTBONOVAC
   store wbasicoejc*WNETOVAC to wnetovac
   IF IPNPERSO->VACACION <> CTOD("  -  -    ") .AND. IPNPERSO->VACACION > IPNPERSO->INGRESO
      **** BUSQUEDA DE LOS MESES DE VACACION A CANCELAR
      GO TOP
      LOCATE FOR meses > WmesVAC
      IF .NOT. FOUND()
         STORE "ERROR, "+WCEDULA+" TABLA DE VACACIONES SIN MESES APROPIADOS" TO MES
         DO AVISO WITH MES
         CLOSE DATA
         CLOSE INDEX
         RETURN TO MASTER
      ENDIF
      IF RECNO()>1
         GO RECNO()-1
      ENDIF
      STORE VACACION TO WTVACACION
      STORE BONOVAC TO WNETOVAC, WTBONOVAC
      STORE WBASICOEJC*WNETOVAC TO WNETOVAC
   ENDIF

   STORE WNETOVAC TO BSBONOVAC, WTBONOVAC
   STORE EXAMEN   TO BSEXAMEN
   STORE WTOTALLIQ TO BSMINIMO

      store BSMINIMO+BSBONOVAC+BSEXAMEN TO WTOTALPAGAR
      *********** CALCULO DEL MONTO ESCRITO
      STORE Wtotalpagar TO WMONTO
      STORE WTOTALPAGAR TO WNETO
      STORE INT(WMONTO/1000000) TO MILLONES
      STORE WMONTO-MILLONES*1000000 TO WMONTO
      STORE INT(WMONTO/1000) TO MILES
      STORE WMONTO-MILES*1000 TO WMONTO
      STORE INT(WMONTO/100) TO CIENTOS
      STORE WMONTO-CIENTOS*100 TO WMONTO
      STORE INT(WMONTO/10) TO DECENAS
      STORE WMONTO-DECENAS*10 TO WMONTO
      STORE INT(WMONTO/1) TO UNIDADES
      STORE WMONTO-UNIDADES*1 TO WMONTO
      STORE (WNETO-INT(WNETO))*100 TO CENTIMOS
      SELECT 9
      USE IPNMONTO
      store space(50) to escrito
      ***** MILLONES ******
      GO TOP
      LOCATE FOR VALOR > MILLONES
      IF .NOT. FOUND()
         STORE "ERROR, NO ENCONTRE LOS MILLONES APROPIADOS" TO MES
         DO AVISO WITH MES
      ENDIF
      GO RECNO()-1
      IF VALOR > 0
         STORE RTRIM(escrito)+" "+DES TO escrito
      ENDIF
      STORE MILLONES-VALOR TO RESTO
      STORE .T. TO CHECKREST
      DO WHILE CHECKREST
         GO TOP
         IF RESTO = 0
            STORE .F. TO CHECKREST
            LOOP
         ENDIF
         LOCATE FOR VALOR > RESTO
         IF .NOT. FOUND()
            STORE "ERROR, NO ENCONTRE EL RESTO DE LOS MILLONES APROPIADOS" TO MES
            DO AVISO WITH MES
         ENDIF
         GO RECNO()-1
         STORE RTRIM(escrito)+" Y "+DES TO escrito
         STORE RESTO-VALOR TO RESTO
      ENDDO
      IF MILLONES = 1
         STORE RTRIM(escrito)+" MILLON " TO escrito
      ELSE
         IF MILLONES > 1
            STORE RTRIM(escrito)+" MILLONES " TO escrito
         ENDIF
      ENDIF
      ***** MILES ******
      GO TOP
      LOCATE FOR VALOR > MILES
      IF .NOT. FOUND()
         STORE "ERROR, NO ENCONTRE LOS MILES APROPIADOS" TO MES
         DO AVISO WITH MES
      ENDIF
      GO RECNO()-1
      IF VALOR > 0
         STORE RTRIM(escrito)+" "+DES TO escrito
      ENDIF
      STORE MILES-VALOR TO RESTO
      IF MILES >= 100 .AND. MILES < 200 .AND. RESTO > 0
         STORE RTRIM(escrito)+"TO" TO escrito
      ENDIF
      STORE .T. TO CHECKREST
      DO WHILE CHECKREST
         GO TOP
         IF RESTO = 0
            STORE .F. TO CHECKREST
            LOOP
         ENDIF
         LOCATE FOR VALOR > RESTO
         IF .NOT. FOUND()
            STORE "ERROR, NO ENCONTRE EL RESTO DE LOS MILES APROPIADOS" TO MES
            DO AVISO WITH MES
         ENDIF
         GO RECNO()-1
         STORE RTRIM(escrito)+" "+DES TO escrito
         STORE RESTO-VALOR TO RESTO
      ENDDO
      IF MILES > 0
         STORE RTRIM(escrito)+" MIL " TO escrito
      ENDIF

      ***** CIENTOS ****
      GO TOP
      LOCATE FOR VALOR > CIENTOS*100
      IF .NOT. FOUND()
         STORE "ERROR, NO ENCONTRE LOS CIENTOS APROPIADOS" TO MES
         DO AVISO WITH MES
      ENDIF
      GO RECNO()-1
      IF VALOR > 0
         STORE RTRIM(escrito)+" "+DES TO escrito
      ENDIF
      IF CIENTOS = 1 .AND. DECENAS*10+UNIDADES > 0
         STORE RTRIM(escrito)+"TO" TO escrito
      ENDIF

      ***** DECENAS ****
      IF DECENAS > 1
         GO TOP
         LOCATE FOR VALOR > DECENAS*10
         IF .NOT. FOUND()
            STORE "ERROR, NO ENCONTRE LAS DECENAS APROPIADAS" TO MES
            DO AVISO WITH MES
         ENDIF
         GO RECNO()-1
         IF VALOR > 0
            STORE RTRIM(escrito)+" "+DES TO escrito
         ENDIF
      ELSE
         STORE DECENAS*10+UNIDADES TO UNIDADES
      ENDIF

      ***** UNIDADES ****
      GO TOP
      LOCATE FOR VALOR > UNIDADES
      IF .NOT. FOUND()
         STORE "ERROR, NO ENCONTRE LAS UNIDADES APROPIADAS" TO MES
         DO AVISO WITH MES
      ENDIF
      GO RECNO()-1
      IF VALOR > 0
         STORE RTRIM(escrito)+" Y "+DES TO escrito
      ENDIF
      STOR UNIDADES-VALOR TO RESTO
      STORE .T. TO CHECKREST
      DO WHILE CHECKREST
         GO TOP
         IF RESTO = 0
            STORE .F. TO CHECKREST
            LOOP
         ENDIF
         LOCATE FOR VALOR > RESTO
         IF .NOT. FOUND()
            STORE "ERROR, NO ENCONTRE EL RESTO DE LAS UNIDADES APROPIADAS" TO MES
            DO AVISO WITH MES
         ENDIF
         GO RECNO()-1
         STORE RTRIM(escrito)+" Y "+DES TO escrito
         STORE RESTO-VALOR TO RESTO
      ENDDO
      STORE RTRIM(escrito)+" Bolivares con " TO escrito

      ***** CENTIMOS ****

      STORE RTRIM(escrito)+" "+LTRIM(RTRIM(STR(CENTIMOS,5)))+" CENTIMOS" TO escrito
      *********  FIN CALCULO MONTO ESCRITO   **********
   IF WFLAGAS = .T.
      SET DEVI TO PRINT
      @ 0,1   SAY CHR(14)+QQWW
      @ 2,13  SAY "FINIQUITO DE INDEMNIZACION POR TERMINACION DE CONTRATO"
      @ 4,35  SAY "LUGAR Y FECHA : "+CHR(15)+RTRIM(WLUGAR)+" "+DTOC(WFECACT)+CHR(18)
      @ 6,1   SAY "Yo, "+RTRIM(WNOMBRE)+" "+WAPELLIDO+" CŠdula de identidad No."+WCEDULA
      @ 8,1   SAY "Hago constar que he recibido de "+QQWW+", la suma de"
      @ 10,1  say "**"+chr(15)+escrito+chr(18)+" ** (Bs. "+str(wtotalpagar,9,2)+" )"
      @ 12,1  SAY "En car cter de Indemnizaci¢n por la terminaci¢n de mi contrato de ----"
      @ 14,1  say "trabajo con ella, en la obra: "+wdescrinom
      @ 16,1  say "seg£n la siguiente relaci¢n:"
      @ 20,1  say "MOTIVO POR EL CUAL TERMINO MI CONTRATO DE TRABAJO: "+WMOTIVO
      @ 21,26 SAY "Fecha de mi Empleo  Dia:"+STR(day(wingreso),2)+"   Mes:"+STR(month(wingreso),2)+"  A¤o:"+STR(year(wingreso),4)
      @ 23,26 SAY "Fecha de mi Retiro  Dia:"+STR(day(fechaliq),2)+"   Mes:"+STR(month(fechaliq),2)+"  A¤o:"+STR(year(fechaliq),4)
      @ 25,26 say "Tiempo de servicio   "+str(wmes,4)+" Meses y "+str(wdias,2)+" Dias"
      @ 27,1  say "SALARIO BASICO : Bs. "+STR(Wbasicodia,8,2)+" DIARIO x 0.333 = "+str(wpordia,7,2)
      @ 29,1  say "PREAVISO ART. 28 Y 29 LEY DEL TRABAJO __________________ Bs.-----------"
      @ 31,1  SAY "ANTIGUEDAD ART. 37 LEY DEL TRABAJO _____________________ Bs.-----------"
      @ 33,1  SAY "INDEMNIZACION DE ANTIGUEDAD CONTRATO PETROLERO _________ Bs.-----------"
      @ 35,1  SAY "CESANTIA ART. 39 LEY DEL TRABAJO _______________________ Bs.-----------"
      @ 37,1  SAY "APARTES ByC CLAUS.22,23y24 _____________________________ Bs.-----------"
      @ 39,1  SAY "VACACIONES PARCIALES ART.53 LEY DEL TRABAJO ------------ Bs.-----------"
      @ 41,1  SAY "BONO VACACIONAL ---------------------------------------- Bs.  "+str(wnetovac,9,2)
      @ 43,1  SAY "INDEMNIZACION MINIMA Bs. "+str(wpordia,7,2)+" x "+str(wtotdias,7,2)+" dias -------- Bs. "+str(wtotalliq,10,2)
      @ 45,1  SAY "EXAMEN DE PRE-EMPLEO Y PRE-RETIRO _____ 1 dia __________ Bs.    "+str(examen,7,2)
      @ 47,1  SAY "TOTAL RECIBIDO EN ESTE ACTO ............................ Bs."+str(wtotalpagar,11,2)
      @ 49,1  SAY "OBSERVACIONES : _______________________________________________________"
      @ 51,1  SAY "_______________________________________________________________________"

      @ 55,30 SAY "____________________"
      @ 57,10 SAY "FIRMA DEL TRABAJADOR"
      SET DEVI TO SCRE
      EJECT
   ENDIF
ELSE
   ***  TRES O MAS MESES ***
   SELECT 4
   USE IPNOMINA
   LOCATE FOR CODNOM = WNOMINA
   IF .NOT. FOUND()
      STORE "ERROR, LA NOMINA DE ESTA PERSONA NO ESTA REGISTRADA" TO MES
      DO AVISO WITH MES
      USE
      RETURN
   ENDIF
   STORE FACTCOD TO WFACTCOD
   STORE DESNOM  TO WDESCRINOM
   STORE LUGAR   TO WLUGAR
   SELECT 4
   USE IPNFACTO
   LOCATE FOR FACCOD = WFACTCOD
   IF .NOT. FOUND()
      STORE "ERROR, LOS FACTORES DE ESTA NOMINA NO ESTA REGISTRADOS" TO MES
      DO AVISO WITH MES
      USE
      RETURN
   ENDIF
   STORE F_AYUCIU                  TO WAYUCIU
   STORE (WSUELDO+WBONOCO+WAYUCIU) TO Wbasicodia
   STORE (WSUELDO+WBONOCO)         TO WbasicoEJC

   STORE WBASICODIA TO VARIABLE
   DO REDONDEO WITH VARIABLE
   STORE VARIABLE TO WBASICODIA
   STORE ROUND(WBASICODIA,2) TO WBASICODIA

   STORE (WSUELDO+WBONOCO) TO EXAMEN
   STORE EXAMEN TO VARIABLE
   DO REDONDEO WITH VARIABLE
   STORE VARIABLE TO EXAMEN
   STORE ROUND(EXAMEN,2) TO BSEXAMEN

   STORE SPACE(35) TO QQWW
   DO INFORMA WITH QQWW
   IF QQWW <> T3
      CLOSE DATA
      CLOSE INDEX
      STORE "ERROR DE INSTALACION" TO MES
      DO AVISO WITH MES
      RETURN
   ENDIF

   store 0 to wnetovac, WTBONOVAC
   SELECT 4
   USE IPNpetro
   GO TOP
   LOCATE FOR meses > Wmes
   IF .NOT. FOUND()
      STORE "ERROR, "+WCEDULA+" TABLA DE LIQUIDACION SIN MESES APROPIADOS" TO MES
      DO AVISO WITH MES
      CLOSE DATA
      CLOSE INDEX
      RETURN TO MASTER
   ENDIF
   IF RECNO()>1
      GO RECNO()-1
   ENDIF
   STORE PREAVISO   TO WTPREAVISO
   STORE ANTIGUEDAD TO WTANTIGUE
   STORE ANTIGUEDA2 TO WTANTIGUE2
   STORE VACACION   TO WTVACACION
   STORE BONOVAC    TO WNETOVAC, WTBONOVAC
   STORE UTILIDAD   TO WTUTILIDAD
   STORE TOTAL      TO WTTOTAL
   STORE GARANTIA   TO WTGARANTIA
   STORE WNETOVAC   TO WTBONANTI

   * ANTIGUEDAD ADICIONAL
   STORE (FECHALIQ-IPNPERSO.INGRESO)+1 TO WDIASAA
   STORE INT(WDIASAA/30.4166667)       TO WMESAA
   SELECT 4
   USE IPNpetro
   GO TOP
   LOCATE FOR meses > WMESAA
   IF .NOT. FOUND()
      STORE "ERROR, "+WCEDULA+" TABLA DE LIQUIDACION SIN MESES DE ANTIG. ADIC." TO MES
      DO AVISO WITH MES
      CLOSE DATA
      CLOSE INDEX
      RETURN TO MASTER
   ENDIF
   IF RECNO()>1
      GO RECNO()-1
   ENDIF
   STORE CESANTIA   TO WTCESANTIA

   store wbasicoejc*wnetovac TO WNETOVAC
   IF WMESVAC>0
      STORE (wnetovac/WMESVAC)/30  TO WBONODIA
   ELSE
      STORE 0 TO WBONODIA
   ENDIF
   IF WLIQEJC > 0
      SELECT 4
      USE IPNpetro
      GO TOP
      LOCATE FOR meses > WLASTWmes
      IF .NOT. FOUND()
         STORE "ERROR, "+WCEDULA+" TABLA DE BONO VACACIONAL SIN MESES APROPIADOS" TO MES
         DO AVISO WITH MES
         CLOSE DATA
         CLOSE INDEX
         RETURN TO MASTER
      ENDIF
      IF RECNO()>1
         GO RECNO()-1
      ENDIF
      store wbasicoejc*3.33*wlastwmes to wnetovac
      IF WLASTWMES>0
         STORE (wnetovac/WLASTWMES)/30  TO WBONODIA
      ELSE
         STORE 0 TO WBONODIA
      ENDIF
   ENDIF

   IF IPNPERSO->VACACION <> CTOD("  -  -    ") .AND. IPNPERSO->VACACION > IPNPERSO->INGRESO
      **** BUSQUEDA DE LOS MESES DE VACACION A CANCELAR
      SELECT 4
      USE IPNPETRO
      GO TOP
      LOCATE FOR meses > WmesVAC
      IF .NOT. FOUND()
         STORE "ERROR, "+WCEDULA+" TABLA DE VACACIONES SIN MESES APROPIADOS" TO MES
         DO AVISO WITH MES
         CLOSE DATA
         CLOSE INDEX
         RETURN TO MASTER
      ENDIF
      IF RECNO()>1
         GO RECNO()-1
      ENDIF
      IF WLIQEJC > 0
         STORE 0 TO WTVACACION
      ELSE
         STORE VACACION TO WTVACACION
      ENDIF
      store wbasicoejc*3.33*wmesvac to wnetovac
      IF WMESVAC>0
         STORE (wnetovac/WMESVAC)/30  TO WBONODIA
      ELSE
         STORE 0 TO WBONODIA
      ENDIF
   ENDIF

   *********** BUSQUEDA DE HISTORICO ****************
   SELECT IPNHISTO
   SORT TO IPNTEMP2 ON FECHA /D FOR CEDULA = WCEDULA .AND. FECHA <= FECHALIQ  .AND. NOMINA <> "LIQUI"
   SELECT 4
   USE IPNTEMP2
   PACK
   IF WTIPO = "E"
      STORE 2 TO BUSCAR
      STORE 30 TO DIVIDIR
   ELSE
      STORE 4 TO BUSCAR
      STORE 28 TO DIVIDIR
   ENDIF

   *******   CALCULO DEL TOTAL BONIFICABLE *************
   STORE 0 TO CONTEO
   STORE 0 TO ACUMULADO
   STORE 0 TO UTILIDADES
   STORE 10 TO ZX
   DO WHILE .NOT. EOF() .AND. CONTEO < BUSCAR
      IF NOMINA<>"UTLDA".AND.DESOCB1<>"V "
         STORE ACUMULADO + BSTOTBON TO ACUMULADO
         STORE CONTEO +1 TO CONTEO
      ELSE
         STORE BSTOTBON             TO UTILIDADES
      ENDIF
      SKIP
   ENDDO
   STORE ACUMULADO/DIVIDIR TO PROMEDIODIA
   STORE PROMEDIODIA TO VARIABLE
   DO REDONDEO WITH VARIABLE
   STORE VARIABLE TO PROMEDIODIA
   STORE ROUND(PROMEDIODIA,2) TO PROMEDIODIA

   *** PREAVISO ***
   STORE WBASICODIA*WTPREAVISO*FFPP TO BSPREAVISO
   STORE BSPREAVISO TO VARIABLE
   DO REDONDEO WITH VARIABLE
   STORE VARIABLE TO BSPREAVISO
   STORE ROUND(BSPREAVISO,2) TO BSPREAVISO

   *** ANTIGUEDAD LEG ***
 * STORE (PROMEDIODIA+IPNPERSO->SALPRO+WBONODIA)*WTANTIGUE*FFAA TO BSANTIGUE
   STORE (PROMEDIODIA)*WTANTIGUE*FFAA TO BSANTIGUE
   STORE BSANTIGUE TO VARIABLE
   DO REDONDEO WITH VARIABLE
   STORE VARIABLE TO BSANTIGUE
   STORE ROUND(BSANTIGUE,2) TO BSANTIGUE

   *** ANTIGUEDAD CONTR.***
 * STORE (PROMEDIODIA+IPNPERSO->SALPRO+WBONODIA)*WTANTIGUE2*FFAA TO BSANTIGUE2
   STORE (PROMEDIODIA)*WTANTIGUE2*FFAA TO BSANTIGUE2
   STORE BSANTIGUE2 TO VARIABLE
   DO REDONDEO WITH VARIABLE
   STORE VARIABLE TO BSANTIGUE2
   STORE ROUND(BSANTIGUE2,2) TO BSANTIGUE2

   *** ANTIGUEDAD ADIC. ***
 * STORE (PROMEDIODIA+IPNPERSO->SALPRO         )*WTCESANTIA*FFCC TO BSCESANTIA
   STORE (PROMEDIODIA)*WTCESANTIA*FFCC TO BSCESANTIA
   STORE BSCESANTIA TO VARIABLE
   DO REDONDEO WITH VARIABLE
   STORE VARIABLE TO BSCESANTIA
   STORE ROUND(BSCESANTIA,2) TO BSCESANTIA

   *** VACACIONES ***
   STORE WBASICODIA*WTVACACION TO BSVACACION
   STORE BSVACACION TO VARIABLE
   DO REDONDEO WITH VARIABLE
   STORE VARIABLE TO BSVACACION
   STORE ROUND(BSVACACION,2) TO BSVACACION

   *** BONO VACACIONAL ***
   STORE WNETOVAC TO BSBONOVAC
   STORE BSBONOVAC TO VARIABLE
   DO REDONDEO WITH VARIABLE
   STORE VARIABLE TO BSBONOVAC
   STORE ROUND(BSBONOVAC,2) TO BSBONOVAC

   *** EXAMEN ***
   STORE BSEXAMEN TO BSEXAMEN

   *** indemnizacion minima adicional de 13 a 19 meses
   store wliqejc*7.5 to wdiasejc
   store wdiasejc * wbasicoEJC to windejc
   STORE WINDEJC TO BSINDCOM

   *** UTILIDAD DE LA ANTIGUEDAD ***
   *STORE UTILIDADES/WTOTDIAS              TO WFACTUTIL
   STORE IPNPERSO->SALPRO                  TO WFACTUTIL
   STORE (WTANTIGUE+WTCESANTIA)*WFACTUTIL  TO BSUTILANTI

   *** BONO VACACIONAL DE LA ANTIGUEDAD
   IF WMES>=12
      STORE ((WTBONANTI/WMES)/30)*WBASICOEJC  TO WFACTBON
      STORE (WTANTIGUE+WTCESANTIA)*WFACTBON   TO BSBONOANTI
   ELSE
      STORE 0 TO WFACTBON
      STORE 0 TO BSBONOANTI
   ENDIF

   *** TOTAL GENERAL
   STORE BSPREAVISO+BSANTIGUE+BSANTIGUE2+BSCESANTIA+BSVACACION+;
         BSBONOVAC+BSEXAMEN+WINDEJC+BSUTILANTI+BSBONOANTI TO WTOTALPAGAR

      *********** CALCULO DEL MONTO ESCRITO
      STORE Wtotalpagar TO WMONTO
      STORE WTOTALPAGAR TO WNETO
      STORE INT(WMONTO/1000000) TO MILLONES
      STORE WMONTO-MILLONES*1000000 TO WMONTO
      STORE INT(WMONTO/1000) TO MILES
      STORE WMONTO-MILES*1000 TO WMONTO
      STORE INT(WMONTO/100) TO CIENTOS
      STORE WMONTO-CIENTOS*100 TO WMONTO
      STORE INT(WMONTO/10) TO DECENAS
      STORE WMONTO-DECENAS*10 TO WMONTO
      STORE INT(WMONTO/1) TO UNIDADES
      STORE WMONTO-UNIDADES*1 TO WMONTO
      STORE (WNETO-INT(WNETO))*100 TO CENTIMOS
      SELECT 9
      USE IPNMONTO
      store space(50) to escrito
      ***** MILLONES ******
      GO TOP
      LOCATE FOR VALOR > MILLONES
      IF .NOT. FOUND()
         STORE "ERROR, NO ENCONTRE LOS MILLONES APROPIADOS" TO MES
         DO AVISO WITH MES
      ENDIF
      GO RECNO()-1
      IF VALOR > 0
         STORE RTRIM(escrito)+" "+DES TO escrito
      ENDIF
      STORE MILLONES-VALOR TO RESTO
      STORE .T. TO CHECKREST
      DO WHILE CHECKREST
         GO TOP
         IF RESTO = 0
            STORE .F. TO CHECKREST
            LOOP
         ENDIF
         LOCATE FOR VALOR > RESTO
         IF .NOT. FOUND()
            STORE "ERROR, NO ENCONTRE EL RESTO DE LOS MILLONES APROPIADOS" TO MES
            DO AVISO WITH MES
         ENDIF
         GO RECNO()-1
         STORE RTRIM(escrito)+" Y "+DES TO escrito
         STORE RESTO-VALOR TO RESTO
      ENDDO
      IF MILLONES = 1
         STORE RTRIM(escrito)+" MILLON " TO escrito
      ELSE
         IF MILLONES > 1
            STORE RTRIM(escrito)+" MILLONES " TO escrito
         ENDIF
      ENDIF
      ***** MILES ******
      GO TOP
      LOCATE FOR VALOR > MILES
      IF .NOT. FOUND()
         STORE "ERROR, NO ENCONTRE LOS MILES APROPIADOS" TO MES
         DO AVISO WITH MES
      ENDIF
      GO RECNO()-1
      IF VALOR > 0
         STORE RTRIM(escrito)+" "+DES TO escrito
      ENDIF
      STORE MILES-VALOR TO RESTO
      IF MILES >= 100 .AND. MILES < 200 .AND. RESTO > 0
         STORE RTRIM(escrito)+"TO" TO escrito
      ENDIF
      STORE .T. TO CHECKREST
      DO WHILE CHECKREST
         GO TOP
         IF RESTO = 0
            STORE .F. TO CHECKREST
            LOOP
         ENDIF
         LOCATE FOR VALOR > RESTO
         IF .NOT. FOUND()
            STORE "ERROR, NO ENCONTRE EL RESTO DE LOS MILES APROPIADOS" TO MES
            DO AVISO WITH MES
         ENDIF
         GO RECNO()-1
         STORE RTRIM(escrito)+" "+DES TO escrito
         STORE RESTO-VALOR TO RESTO
      ENDDO
      IF MILES > 0
         STORE RTRIM(escrito)+" MIL " TO escrito
      ENDIF

      ***** CIENTOS ****
      GO TOP
      LOCATE FOR VALOR > CIENTOS*100
      IF .NOT. FOUND()
         STORE "ERROR, NO ENCONTRE LOS CIENTOS APROPIADOS" TO MES
         DO AVISO WITH MES
      ENDIF
      GO RECNO()-1
      IF VALOR > 0
         STORE RTRIM(escrito)+" "+DES TO escrito
      ENDIF
      IF CIENTOS = 1 .AND. DECENAS*10+UNIDADES > 0
         STORE RTRIM(escrito)+"TO" TO escrito
      ENDIF

      ***** DECENAS ****
      IF DECENAS > 1
         GO TOP
         LOCATE FOR VALOR > DECENAS*10
         IF .NOT. FOUND()
            STORE "ERROR, NO ENCONTRE LAS DECENAS APROPIADAS" TO MES
            DO AVISO WITH MES
         ENDIF
         GO RECNO()-1
         IF VALOR > 0
            STORE RTRIM(escrito)+" "+DES TO escrito
         ENDIF
      ELSE
         STORE DECENAS*10+UNIDADES TO UNIDADES
      ENDIF

      ***** UNIDADES ****
      GO TOP
      LOCATE FOR VALOR > UNIDADES
      IF .NOT. FOUND()
         STORE "ERROR, NO ENCONTRE LAS UNIDADES APROPIADAS" TO MES
         DO AVISO WITH MES
      ENDIF
      GO RECNO()-1
      IF VALOR > 0
         STORE RTRIM(escrito)+" Y "+DES TO escrito
      ENDIF
      STOR UNIDADES-VALOR TO RESTO
      STORE .T. TO CHECKREST
      DO WHILE CHECKREST
         GO TOP
         IF RESTO = 0
            STORE .F. TO CHECKREST
            LOOP
         ENDIF
         LOCATE FOR VALOR > RESTO
         IF .NOT. FOUND()
            STORE "ERROR, NO ENCONTRE EL RESTO DE LAS UNIDADES APROPIADAS" TO MES
            DO AVISO WITH MES
         ENDIF
         GO RECNO()-1
         STORE RTRIM(escrito)+" Y "+DES TO escrito
         STORE RESTO-VALOR TO RESTO
      ENDDO
      STORE RTRIM(escrito)+" Bolivares con " TO escrito

      ***** CENTIMOS ****

      STORE RTRIM(escrito)+" "+LTRIM(RTRIM(STR(CENTIMOS,5)))+" CENTIMOS" TO escrito
      *********  FIN CALCULO MONTO ESCRITO   **********
   IF WFLAGAS = .T.
      SET DEVI TO PRINT
      @ 0,1   SAY CHR(14)+QQWW
      @ 2,13  SAY "FINIQUITO DE INDEMNIZACION POR TERMINACION DE CONTRATO"
      @ 4,35  SAY "LUGAR Y FECHA : "+CHR(15)+RTRIM(WLUGAR)+" "+DTOC(WFECACT)+CHR(18)
      @ 6,1   SAY "Yo, "+RTRIM(WNOMBRE)+" "+WAPELLIDO+" CŠdula de identidad No."+WCEDULA
      @ 8,1   SAY "Hago constar que he recibido de "+QQWW+", la suma de"
      @ 10,1  say "**"+chr(15)+escrito+chr(18)+" ** (Bs. "+str(wtotalpagar,9,2)+" )"
      @ 12,1  SAY "En car cter de Indemnizaci¢n por la terminaci¢n de mi contrato de ----"
      @ 14,1  say "trabajo con ella, en la obra: "+wdescrinom
      @ 16,1  say "seg£n la siguiente relaci¢n:"
      @ 19,1  say "MOTIVO POR EL CUAL TERMINO MI CONTRATO DE TRABAJO: "+WMOTIVO
      @ 21,26 SAY "Fecha de mi Empleo  Dia:"+STR(day(wingreso),2)+"   Mes:"+STR(month(wingreso),2)+"  A¤o:"+STR(year(wingreso),4)
      @ 23,26 SAY "Fecha de mi Retiro  Dia:"+STR(day(fechaliq),2)+"   Mes:"+STR(month(fechaliq),2)+"  A¤o:"+STR(year(fechaliq),4)
      @ 25,26 say "Tiempo de servicio   "+str(WLASTwmes,4)+" Meses y "+str(wdias,2)+" Dias"
      @ 27,1  SAY "SALARIO BASICO   : Bs. "+STR(WBASICOEJC, 8,2)+" DIARIO"
      @ 28,1  say "SALARIO NORMAL   : Bs. "+STR(Wbasicodia, 8,2)+" DIARIO"
      @ 29,1  SAY "SALARIO INTEGRAL : Bs. "+STR(PROMEDIODIA,8,2)+" DIARIO"
      @ 31,1  say "PREAVISO                    :"+STR(WTPREAVISO,7,2)+" x "+STR(FFPP,1)+" x "+STR(WBASICODIA, 8,2)+"    = Bs."+STR(BSPREAVISO, 12,2)
      @ 33,1  SAY "ANTIGUEDAD LEGAL            :"+STR(WTANTIGUE, 7,2)+" x "+STR(FFAA,1)+" x "+STR(PROMEDIODIA,8,2)+"    = Bs."+STR(BSANTIGUE,  12,2)
      @ 35,1  SAY "ANTIGUEDAD CONTRACTUAL      :"+STR(WTANTIGUE2,7,2)+" x "+STR(FFAA,1)+" x "+STR(PROMEDIODIA,8,2)+"    = Bs."+STR(BSANTIGUE2, 12,2)
      @ 37,1  SAY "ANTIGUEDAD ADICIONAL        :"+STR(WTCESANTIA,7,2)+" x "+STR(FFCC,1)+" x "+STR(PROMEDIODIA,8,2)+"    = Bs."+STR(BSCESANTIA, 12,2)
      @ 39,1  say "VACACIONES PARCIALES        :"+STR(WTVACACION,7,2)+" x 1 x "+STR(WBASICODIA,8,2)               +"    = Bs."+STR(BSVACACION, 12,2)
      @ 41,1  SAY "BONO VACACIONAL             :"+SPACE(22)                                                       +"    = Bs."+STR(BSBONOVAC,  12,2)
      @ 43,1  SAY "INDEMNIZACION MINIMA        :"+STR(WDIASEJC  ,7,2)+" x "+STR(WBASICOEJC,8,2)+SPACE(4)          +"    = Bs."+STR(WINDEJC,    12,2)
      @ 45,1  SAY "EXAMEN MEDICO               :"+SPACE(22)                                                       +"    = Bs."+STR(bsexamen,   12,2)
      @ 47,1  SAY "UTILIDAD/ANTIGUEDAD         :"+STR(WTANTIGUE+WTCESANTIA,7,2)+" x 1 x "+STR(WFACTUTIL,8,2)      +"    = Bs."+STR(BSUTILANTI, 12,2)
      @ 49,1  SAY "BONO VACACIONAL/ANTIGUEDAD  :"+STR(WTANTIGUE+WTCESANTIA,7,2)+" x 1 x "+STR(WFACTBON, 8,2)      +"    = Bs."+STR(BSBONOANTI, 12,2)
      @ 53,1  SAY "TOTAL RECIBIDO EN ESTE ACTO :"+SPACE(22)                                                       +"    = Bs."+STR(wtotalpagar,12,2)

      @ 57,30 SAY "____________________"
      @ 59,10 SAY "FIRMA DEL TRABAJADOR"
      SET DEVI TO SCRE
      EJECT
   ENDIF
ENDIF

IF WFLAGAS = .T.
   SELECT 2
   STORE WCEDULA+DTOC(FECHALIQ)+"LIQUI" TO WCLAVEHIST
   FIND &WCLAVEHIST
   IF EOF()
      APPEND BLANK
      REPLACE CEDULA   WITH WCEDULA
      REPLACE FECHA    WITH FECHALIQ
      REPLACE NOMINA   WITH "LIQUI"
   ENDIF
   REPLACE ELABORADA   WITH WFECACT
   REPLACE BASICO      WITH BASICODIA
   ***********************************
   STORE INT(WMES/12)                TO WANOSSER
   STORE ((WMES/12)-INT(WMES/12))*12 TO WMESESSER
   STORE WDIAS                       TO WDIASSER
   *
   REPLACE INGRESO     WITH  IPNPERSO->INGRESO
   REPLACE ANOSSER     WITH  WANOSSER
   REPLACE MESESSER    WITH  WMESESSER
   REPLACE DIASSER     WITH  WDIASSER
   REPLACE MOTIVOLIQ   WITH  WTIPOLIQ
   *
   REPLACE  DPRE       WITH  WTPREAVISO
   REPLACE  TSALPRE    WITH  "N"
   REPLACE  PREAVISO   WITH  BSPREAVISO
   *
   REPLACE  DANT       WITH  WTANTIGUE
   REPLACE  TSALANT    WITH  "I"
   REPLACE  ANTIGUE    WITH  BSANTIGUE
   *
   REPLACE  DANT2      WITH  WTANTIGUE2
   REPLACE  TSALANT2   WITH  "I"
   REPLACE  ANTIGUE2   WITH  BSANTIGUE2
   *
   REPLACE  DANTADI    WITH  WTCESANTIA
   REPLACE  TSALANTADI WITH  "I"
   REPLACE  CESANTIA   WITH  BSCESANTIA
   *
   REPLACE  DVAC       WITH  WTVACACION
   REPLACE  TSALVAC    WITH  "N"
   REPLACE  VACACION   WITH  BSVACACION
   *
   REPLACE  DBONVAC    WITH  WTBONOVAC
   REPLACE  TSALBONVAC WITH  "B"
   REPLACE  BONOVAC    WITH  BSBONOVAC
   *
   REPLACE  DMIN       WITH  WDIASEJC
   REPLACE  TSALMIN    WITH  "B"
   REPLACE  MINIMO     WITH  BSMINIMO
   *
   REPLACE  DEXA       WITH  1
   REPLACE  TSALEXA    WITH  "B"
   REPLACE  EXAMEN     WITH  BSEXAMEN
   *
   REPLACE  DUTILANT   WITH  WTANTIGUE+WTCESANTIA
   REPLACE  TSUTILANT  WITH  "X"
   REPLACE  UTILANT    WITH  BSUTILANTI
   *
   REPLACE  DBONOANT   WITH  WTANTIGUE+WTCESANTIA
   REPLACE  TSBONOANT  WITH  "X"
   REPLACE  BONOANT    WITH  BSBONOANTI
   *
   REPLACE  INDCOM     WITH  BSINDCOM
   REPLACE  TOTALLIQ   WITH  WTOTALPAGAR
ENDIF
RETURN


