STORE "COMPROBANTE DE CONTABILIDAD" TO HEAD
SELECT 1
USE IPNHISTO
COPY STRU TO HISTTEMP
SELECT 1
USE HISTTEMP
SELECT 2
USE IPNOMINA INDEX IPNOMINA
SELECT 3
USE IPNCOREM INDEX IPNCOREM
COPY STRU TO CODBON
COPY STRU TO CODNOBON

@ 5,0 CLEAR TO 15,79
@ 5,0 TO 15,79 DOUBLE
@ 5,40 - (LEN(HEAD)/2) SAY HEAD
@ 7,5 SAY "DESDE :"
@ 9,5 SAY "HASTA :"

STORE "INGRESE LOS PARAMETROS DE LAS FECHAS DE     E L A B O R A C I O N" TO MES
DO MENSAJE WITH MES

STORE CTOD("  -  -    ") TO F1
STORE CTOD("  -  -    ") TO F2
@ 7,12 GET F1
READ
IF F1 = CTOD("  -  -    ")
   CLOSE DATA
   CLOSE INDEX
   RETURN
ENDIF

STORE CTOD("  -  -    ") TO F2
@ 9,12 GET F2
READ
IF F2 = CTOD("  -  -    ")
   CLOSE DATA
   CLOSE INDEX
   RETURN
ENDIF
IF F1 > F2
   STORE "LA FECHA DE TERMINO ES MENOR QUE LA DE INICIO" TO MES
   DO AVISO WITH MES
   CLOSE DATA
   CLOSE INDEX
   RETURN
ENDIF
STORE "Opciones: (C)ontinuar, (S)alir" to mes
store "C" to p1
store "S" to p2
store " " to resp
do pide2 with p1,p2,mes,resp
if resp = "S"
   close data
   close index
   return
endif

STORE "PROCESANDO INFORMACION ..." TO MES
DO MENSAJE WITH MES

SELECT 1
USE HISTTEMP
APPEND FROM IPNHISTO FOR ELABORADA >= F1 .AND. ELABORADA <= F2 .AND. NOMINA <> "UTLDA" .AND. NOMINA <> "LIQUI"
SELECT 4
USE CODBON
SELECT 2
GO TOP
DO WHILE .NOT. EOF()
   IF CODBON <> SPACE(12)
      STORE CODBON TO WCODBON
      SELECT 4
      GO TOP
      LOCATE FOR CODIGO = WCODBON
      IF .NOT. FOUND()
         APPEND BLANK
         REPLACE CODIGO WITH WCODBON
         REPLACE DESCRI WITH IPNOMINA->DESNOM
      ENDIF
   ENDIF
   SELECT 2
   SKIP
ENDDO
SELECT 4
INDEX ON CODIGO TO CODBON

SELECT 5
USE CODNOBON
SELECT 2
GO TOP
DO WHILE .NOT. EOF()
   IF CODNOBON <> SPACE(12)
      STORE CODNOBON TO WCODNOBON
      SELECT 5
      GO TOP
      LOCATE FOR CODIGO = WCODNOBON
      IF .NOT. FOUND()
         APPEND BLANK
         REPLACE CODIGO WITH WCODNOBON
         REPLACE DESCRI WITH IPNOMINA->DESNOM
      ENDIF
   ENDIF
   SELECT 2
   SKIP
ENDDO
SELECT 5
INDEX ON CODIGO TO CODNOBON

*** *** *** *** *** ***
STORE 0 TO PAGINA
STORE 100 TO LINE

SELECT 4
STORE 0 TO WTOTBON
GO TOP
DO WHILE .NOT. EOF()
   STORE 0 TO WCODBONBS
   STORE CODIGO TO WCODBON
   STORE DESCRI TO WBONDES
   SELECT 2
   GO TOP
   LOCATE FOR CODBON = WCODBON
   DO WHILE .NOT. EOF()
      STORE CODNOM TO WNOMINA
      SELECT 1
      GO TOP
      LOCATE FOR NOMINA = WNOMINA
      DO WHILE .NOT. EOF()
         STORE WCODBONBS+BSTOTBON TO WCODBONBS
         STORE WTOTBON+BSTOTBON TO WTOTBON
         SELECT 1
         CONTINUE
      ENDDO
      SELECT 2
      CONTINUE
   ENDDO
   IF WCODBONBS > 0
      STORE LINE+1 TO LINE
      IF LINE > 55
         SET DEVI TO PRINT
         STORE PAGINA + 1 TO PAGINA
         @ 1,0 SAY CHR(14)+QQWW
         @ 2,65 SAY "FECHA:"+DTOC(WFECACT)
         @ 3,65 SAY "PAGINA:"+STR(PAGINA,3)
         @ 4,0 SAY HEAD+" DEL "+DTOC(F1)+" AL "+DTOC(F2)
         @ 6,0 SAY "CODIGO CONTB."
         @ 6,15 SAY "DESCRIPCION"
         @ 6,53 SAY "D E B E "
         @ 6,69 SAY "H A B E R"
         @ 7,0 SAY "-------------"
         @ 7,15 SAY "-----------"
         @ 7,53 SAY "------- "
         @ 7,69 SAY "---------"
         STORE 8 TO LINE
      ENDIF
      SELECT 3
      FIND &WCODBON
      IF .NOT. EOF()
         STORE DESCRI TO WBONDES
      ENDIF
      @ LINE, 0 SAY WCODBON
      @ LINE,15 SAY WBONDES
      @ LINE,50 SAY WCODBONBS  PICTURE "#######.##"
   ENDIF
   SELECT 4
   SKIP
ENDDO
**********************************************************************
IF LINE > 40
   STORE 100 TO LINE
ENDIF
SELECT 5
GO TOP
DO WHILE .NOT. EOF()
   STORE 0 TO WCODBONBS
   STORE CODIGO TO WCODNOBON
   STORE DESCRI TO WNOBONDES
   SELECT 2
   GO TOP
   LOCATE FOR CODNOBON = WCODNOBON
   DO WHILE .NOT. EOF()
      STORE CODNOM TO WNOMINA
      SELECT 1
      GO TOP
      LOCATE FOR NOMINA = WNOMINA
      DO WHILE .NOT. EOF()
         STORE WCODBONBS+BSTOTNBON TO WCODBONBS
         STORE WTOTBON+BSTOTNBON TO WTOTBON
         SELECT 1
         CONTINUE
      ENDDO
      SELECT 2
      CONTINUE
   ENDDO
   IF WCODBONBS > 0
      STORE LINE+1 TO LINE
      IF LINE > 55
         SET DEVI TO PRINT
         STORE PAGINA + 1 TO PAGINA
         @ 1,0 SAY CHR(14)+QQWW
         @ 2,65 SAY "FECHA:"+DTOC(WFECACT)
         @ 3,65 SAY "PAGINA:"+STR(PAGINA,3)
         @ 4,0 SAY HEAD+" DEL "+DTOC(F1)+" AL "+DTOC(F2)
         @ 6,0 SAY "CODIGO CONTB."
         @ 6,15 SAY "DESCRIPCION"
         @ 6,53 SAY "D E B E "
         @ 6,69 SAY "H A B E R"
         @ 7,0 SAY "-------------"
         @ 7,15 SAY "-----------"
         @ 7,53 SAY "------- "
         @ 7,69 SAY "---------"
         STORE 8 TO LINE
      ENDIF
      SELECT 3
      FIND &WCODNOBON
      IF .NOT. EOF()
         STORE DESCRI TO WNOBONDES
      ENDIF
      @ LINE, 0 SAY WCODNOBON
      @ LINE,15 SAY WNOBONDES
      @ LINE,50 SAY WCODBONBS  PICTURE "#######.##"
   ENDIF
   SELECT 5
   SKIP
ENDDO
**********************************************************************
IF LINE > 40
   STORE 100 TO LINE
ENDIF
SELECT 3
USE IPNPERSO INDEX IPNPERSO
SELECT 1
GO TOP
STORE 0 TO WISLR
STORE 0 TO WSSO
STORE 0 TO WSPF
STORE 0 TO WAH
STORE 0 TO WPETRO
STORE 0 TO WCONST
STORE 0 TO WPREST
DO WHILE .NOT. EOF()
    STORE CEDULA TO WCEDULA
    SELECT 3
    FIND &WCEDULA
    IF EOF()
       STORE "LA CEDULA "+WCEDULA+" NO EXISTE EN MASTRO. EL OBRERO SE IGNORADO" TO MES
       DO AVISO WITH MES
       SELECT 1
       SKIP
       LOOP
    ELSE
       STORE CONTRATO TO WCONTRATO
    ENDIF
    SELECT 1
    STORE WISLR+BSISLR TO WISLR
    STORE WSSO+BSSSO TO WSSO
    STORE WSPF+BSSPF TO WSPF
    STORE WAH+BSAHRHAB TO WAH
    STORE WPREST+BSPRESPER TO WPREST
    IF WCONTRATO = "PETROLERO" .OR. WCONTRATO = "PEQUIVEN"
       STORE WPETRO+BSSINDIC TO WPETRO
    ENDIF
    IF WCONTRATO = "CONSTRUCCION"
       STORE WCONST+BSSINDIC TO WCONST
    ENDIF
    SELECT 1
    SKIP
 ENDDO

STORE LINE+1 TO LINE
IF LINE > 55
   SET DEVI TO PRINT
   STORE PAGINA + 1 TO PAGINA
   @ 1,0 SAY CHR(14)+QQWW
   @ 2,65 SAY "FECHA:"+DTOC(WFECACT)
   @ 3,65 SAY "PAGINA:"+STR(PAGINA,3)
   @ 4,0 SAY HEAD+" DEL "+DTOC(F1)+" AL "+DTOC(F2)
   @ 6,0 SAY "CODIGO CONTB."
   @ 6,15 SAY "DESCRIPCION"
   @ 6,53 SAY "D E B E "
   @ 6,69 SAY "H A B E R"
   @ 7,0 SAY "-------------"
   @ 7,15 SAY "-----------"
   @ 7,53 SAY "------- "
   @ 7,69 SAY "---------"
   STORE 8 TO LINE
ENDIF
SELECT 4
USE IPNCORET
IF WISLR > 0
   STORE LINE+1 TO LINE
   @ LINE,0 SAY ISLR
   @ LINE,15 SAY "IMPUESTO SOBRE LA RENTA"
   @ LINE,67 SAY WISLR PICTURE "#######.##"
ENDIF
IF WSSO > 0 .OR.WSPF > 0
   STORE LINE+1 TO LINE
   @ LINE,0 SAY SSO
   @ LINE,15 SAY "SEGURO SOCIAL y PARO FORZOSO"
   @ LINE,67 SAY WSSO+WSPF PICTURE "#######.##"
ENDIF
*IF WSPF > 0
*   STORE LINE+1 TO LINE
*   @ LINE,0 SAY SPF
*   @ LINE,15 SAY "SEGURO DE PARO FORZOSO "
*   @ LINE,67 SAY WSPF PICTURE "#######.##"
*ENDIF
IF WAH > 0
   STORE LINE+1 TO LINE
   @ LINE,0 SAY AH
   @ LINE,15 SAY "AHORRO HABITACIONAL    "
   @ LINE,67 SAY WAH PICTURE "#######.##"
ENDIF
IF PRESTAMO = SPACE(12)
   STORE 0 TO WPREST
   ELSE
   STORE LINE+1 TO LINE
   @ LINE,0 SAY PRESTAMO
   @ LINE,15 SAY "PRESTAMOS              "
   @ LINE,67 SAY WPREST PICTURE "#######.##"
ENDIF
IF WPETRO > 0
   STORE LINE+1 TO LINE
   @ LINE,0 SAY PETROLERO
   @ LINE,15 SAY "SINDICATO PETROLERO    "
   @ LINE,67 SAY WPETRO PICTURE "#######.##"
ENDIF
IF WCONST > 0
   STORE LINE+1 TO LINE
   @ LINE,0 SAY CONSTRUC
   @ LINE,15 SAY "SINDICATO CONSTRUCCION "
   @ LINE,67 SAY WCONST PICTURE "#######.##"
ENDIF
STORE WISLR+WSSO+WSPF+WAH+WPREST+WPETRO+WCONST TO WTOTRET
STORE WTOTBON-WTOTRET TO WMONTO
STORE LINE+2 TO LINE
@ LINE,0 SAY "CHEQUE No. ---------------- BANCO: -------------------"
@ LINE,67 SAY WMONTO PICTURE "#######.##"
STORE WMONTO+WTOTRET TO WTOTHABER

STORE LINE+1 TO LINE
@ LINE, 48 SAY "============"
@ LINE, 65 SAY "============"
STORE LINE+1 TO LINE
@ LINE,0 SAY "T O T A L E S"
@ LINE,49 SAY WTOTBON PICTURE "########.##"
@ LINE,66 SAY WTOTHABER PICTURE "########.##"
EJECT
SET DEVI TO SCRE
CLOSE DATA
CLOSE INDEX
DELETE FILE HISTTEMP.DBF
DELETE FILE CODBON.DBF
DELETE FILE CODNOBON.DBF
DELETE FILE CODBON.IDX
DELETE FILE CODNOBON.IDX
RETURN
